<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    
    <title>haigeek blog</title>
    <description>I&#39;m a software engineer , Use Java as the primary programming language, Interested in Microervices, K8s, Devops ... In this blog , I share my technical problems and life records. </description>
    <link>https://haigeek.me</link>
    
    <language>en</language>
    <copyright>Copyright 2023, Calvin Tran</copyright>
    <lastBuildDate>Sun, 13 Aug 2023 17:14:21 +0800</lastBuildDate>
    <generator>Hugo - gohugo.io</generator>
    <docs>http://cyber.harvard.edu/rss/rss.html</docs>
    <atom:link href="https://haigeek.me/atom.xml" rel="self" type="application/atom+xml"/>
    
    
    <item>
      <title>一次磁盘误操作恢复记录</title>
      <link>https://haigeek.me/posts/ops/disk-recovery-experience/</link>
      <description>&lt;h2 id=&#34;起因&#34;&gt;起因&lt;/h2&gt;
&lt;p&gt;服务器使用hyperv创建了一台虚拟机，早期创建的磁盘大小是300G，但是随着长时间的使用系统磁盘，需要对磁盘进行扩容。hyper-v的磁盘扩容并不算复杂，我参照这了这篇&lt;a href=&#34;https://www.linuxprobe.com/hyperv-data-centos7.html&#34;&gt;文章&lt;/a&gt;，找到磁盘调整大小并重启后机器即可识别到新的磁盘大小。&lt;/p&gt;
&lt;h2 id=&#34;错误操作&#34;&gt;错误操作&lt;/h2&gt;
&lt;p&gt;开机使用 lsblk 识别到新的磁盘大小之后就对磁盘开始分区，我这里的磁盘是 /dev/sdb&lt;/p&gt;
&lt;p&gt;执行 fdisk  /dev/sdb ，进行了下述操作&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;删除旧分区&lt;/li&gt;
&lt;li&gt;创建新的分区&lt;/li&gt;
&lt;li&gt;为新的分区划分全部空间&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在划分完新的空间之后，程序提示我:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Partition&lt;/span&gt; #&lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;contains&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ext4&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;signature&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此时我对这个提示表示疑惑，简单百度资料之后直接选择了删除，结果也就操作了分区数据的丢失。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./images/remove-signature.png&#34;
  alt=&#34;remove-signature&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;具体的表现在于：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;磁盘无法被正常挂载，提示未知错误（具体的报错没有记录了）&lt;/li&gt;
&lt;li&gt;磁盘无法使用&lt;code&gt;resize2fs&lt;/code&gt; 执行合并&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;补救&#34;&gt;补救&lt;/h2&gt;
&lt;h3 id=&#34;备份磁盘数据&#34;&gt;备份磁盘数据&lt;/h3&gt;
&lt;p&gt;因为这个磁盘数据已经有300G，磁盘是机械磁盘，因此存有侥幸心里并没有对磁盘进行备份。意识到磁盘可能出问题之后，还是花了2个多小时对磁盘进行了备份，这里我备份的方式是选择通过hyperv管理器新建一个磁盘，选择从已有磁盘还原数据的方式，速度能稳定在50M/s，相比直接备份磁盘文件会快不少。虽然说现在备份已经为时已晚，但是想到后续如果还是要再操作，万一数据错的更离谱，总比什么都没有好。&lt;/p&gt;
&lt;h3 id=&#34;使用-testdisk-进行恢复&#34;&gt;使用 testdisk 进行恢复&lt;/h3&gt;
&lt;p&gt;查了一圈资料，选择使用 testdisk 进行数据恢复。按照官网的给出的&lt;a href=&#34;https://www.cgsecurity.org/wiki/Testdisk_%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97&#34;&gt;教程&lt;/a&gt;执行下来，也可以直接阅读阿里云提供的&lt;a href=&#34;https://help.aliyun.com/zh/ecs/use-cases/restore-data-in-linux-instances?spm=a2c4g.11186623.0.0.73da249dASt2fn&#34;&gt;文档&lt;/a&gt;，情况如下。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以识别到被删除的分区&lt;/li&gt;
&lt;li&gt;执行分区恢复之后问题依然存在，磁盘不能被挂载。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;尝试进行superblock修复&#34;&gt;尝试进行Superblock修复&lt;/h3&gt;
&lt;p&gt;testdisk 除了回恢复分区模式之外，还提供了直接恢复数据的方式，在扫描出分区之后可以直接按 p 列出当前磁盘分区下的文件，我发现我的文件都还在，所以我觉得数据应该还是可以恢复的，只不过是方式不对，加上上一步已经对数据进行了备份，于是就进一步开始尝试恢复的方式。&lt;/p&gt;
&lt;p&gt;使用 &lt;code&gt;testdisk /dev/sdb&lt;/code&gt; 进入数据恢复界面。选择 Advanced&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./images/testdisk-1.png&#34;
  alt=&#34;testdisk-1&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;程序列出了识别到的分区，选择 Superblock&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;超级块保存了文件系统设定的文件块大小、操作函数、inode链表等重要信息&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img
  src=&#34;./images/testdisk-2.png&#34;
  alt=&#34;testdisk-2&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./images/testdisk-superblock.png&#34;
  alt=&#34;testdisk-superblock&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;可以看到superblock信息被识别出来了，按照程序的提示：如果希望修复文件系统使用备用的超级块，可以执行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;fsck&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;ext4&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;p&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;superblock&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;B&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;blocksize&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;device&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;但是这个命令只是提示，需要把对应的参数修改为自己的，testdisk 已经显示出当前磁盘的分区superblock信息，替换后执行的命令为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;fsck&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;ext4&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;p&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;b&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;32768&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;B&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;4096&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;dev&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;sdb1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;参数解释：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;superblock  指定备用超级块的位置&lt;/li&gt;
&lt;li&gt;blocksize 块大小&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;命令执行结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;./images/exec-fsck-superblock.png&#34;
  alt=&#34;exec-fsck-superblock&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;在执行了上述命令之后，磁盘可以被成功挂载了，挂载之后数据也都存在，数据并没有丢失。&lt;/p&gt;
&lt;h2 id=&#34;误删分析&#34;&gt;误删分析&lt;/h2&gt;
&lt;p&gt;磁盘分区误操作的核心在于这一句提示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-jsx&#34; data-lang=&#34;jsx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Do&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;you&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;want&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;remove&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;the&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;signature&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;?&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;Y&lt;/span&gt;]&lt;span style=&#34;color:#e06c75&#34;&gt;es&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;/&lt;/span&gt;[&lt;span style=&#34;color:#e06c75&#34;&gt;N&lt;/span&gt;]&lt;span style=&#34;color:#e06c75&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我选择了 &lt;code&gt;Y&lt;/code&gt;，选择移除的话分区的 UUID 会发生变更，也就是一个全新的磁盘，且之前的分区信息（例如分区是什么的格式）都不复存在。所以我在进行挂载的时候会提示我无法识别的分区，此时如果直接对这个磁盘进行格式化然后重新划分分区，也是可以被挂载的，代价就是数据就真的全无了。&lt;/p&gt;
&lt;h2 id=&#34;分区备份&#34;&gt;分区备份&lt;/h2&gt;
&lt;p&gt;经过这一次操作，再次认识到数据备份的重要性。&lt;/p&gt;
&lt;p&gt;使用 &lt;strong&gt;&lt;code&gt;sfdisk&lt;/code&gt;&lt;/strong&gt; 命令备份和还原分区表：
&lt;strong&gt;&lt;code&gt;sfdisk&lt;/code&gt;&lt;/strong&gt; 命令可以用于备份和还原分区表。要备份分区表，执行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;sudo sfdisk -d /dev/sdb1 &amp;gt; /path/to/backup/partition_table_backup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这会将磁盘 &lt;strong&gt;&lt;code&gt;/dev/sdb1&lt;/code&gt;&lt;/strong&gt; 的分区表信息备份到指定路径的文件中。&lt;/p&gt;
&lt;p&gt;要还原备份的分区表，执行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;sudo sfdisk /dev/sdb1 &amp;lt; /path/to/backup/partition_table_backup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这会将备份的分区表信息还原到磁盘 &lt;strong&gt;&lt;code&gt;/dev/sdb1&lt;/code&gt;&lt;/strong&gt; 上。&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/ops/disk-recovery-experience/</guid>
      <pubDate>Sun, 13 Aug 2023 17:14:21 +0800</pubDate>
    </item>
    
    <item>
      <title>DubboRpc的ExceptionFilter过滤器</title>
      <link>https://haigeek.me/posts/backend/dubbo/dubbo-rpc-filter-exception-handler/</link>
      <description>&lt;p&gt;在使用dubbo进行接口调用的时候,在接口抛出异常的时候会在ExceptionFilter最终抛出异常。&lt;/p&gt;
&lt;h1 id=&#34;dubbo-filter下的异常处理&#34;&gt;Dubbo filter下的异常处理&lt;/h1&gt;
&lt;h2 id=&#34;场景&#34;&gt;场景&lt;/h2&gt;
&lt;p&gt;现有的异常处理下,很多时候我们总是会遇到下面的这个异常&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;com.alibaba.dubbo.rpc.filter.ExceptionFilter invoke xxx
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img
  src=&#34;images/image-20190730113116205-5755339.png&#34;
  alt=&#34;image-20190730113116205&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;那就存在一个问题&lt;/p&gt;
&lt;p&gt;我明明自己定义了自定义异常(继承自RuntimeException),在全局异常处理也做了对应的处理&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730113307443.png&#34;
  alt=&#34;image-20190730113307443&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;但是并没有被处理.&lt;/p&gt;
&lt;h2 id=&#34;分析&#34;&gt;分析&lt;/h2&gt;
&lt;p&gt;查看dubboFileter的ExceptionFilter发现:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730121941914.png&#34;
  alt=&#34;image-20190730121941914&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

抛出异常的代码在68行,查看上下文分析在什么时候会抛出这个异常&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730122226943.png&#34;
  alt=&#34;image-20190730122226943&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;p&gt;那么我们想直接返回异常的message给到前端的时候,根据源码可以制定下面两种方式&lt;/p&gt;
&lt;p&gt;1、使用非运行时异常Exception&lt;/p&gt;
&lt;p&gt;检查型异常Exception按照常规的方式,在每一层(domain、seviceImpl、interface层)抛出Exception&lt;/p&gt;
&lt;p&gt;但是要注意的是:&lt;strong&gt;在使用非运行时异常的时候,代码检查工具sonar推荐不要直接Throw Exception,而是抛出明确的异常来提升代码的可读性.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;2、使用RunTimeException,但是只在接口层抛出即可&lt;/p&gt;
&lt;p&gt;如下:&lt;/p&gt;
&lt;p&gt;接口层&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730122743081.png&#34;
  alt=&#34;image-20190730122743081&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;实现层,在实现层不需要专门抛出&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730122812991.png&#34;
  alt=&#34;image-20190730122812991&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;效果:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20190730122906444.png&#34;
  alt=&#34;image-20190730122906444&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/backend/dubbo/dubbo-rpc-filter-exception-handler/</guid>
      <pubDate>Sun, 27 Dec 2020 00:34:27 +0800</pubDate>
    </item>
    
    <item>
      <title>Dubbo Rpc 使用随机端口</title>
      <link>https://haigeek.me/posts/backend/dubbo/dubbo-random-port/</link>
      <description>&lt;p&gt;dubbo在进行服务间通信的时候需要使用端口进行通信,但是这个端口的指定规则是什么。&lt;/p&gt;
&lt;h2 id=&#34;随机端口生成方式&#34;&gt;随机端口生成方式&lt;/h2&gt;
&lt;p&gt;查看源码定位到dubbo获取端口的方法在&lt;code&gt;doExportUrlsFor1Protocol&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;此方法中关于端口的代码如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//从dubbo:protocol标签中读取port配置 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Integer&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;protocolConfig&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//如果有provider标签配置，且protocol中port配置为null 或者 0，则直接使用provider中的port端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;provider&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;provider&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//根据协议类型获取默认端口号（默认端口为20880）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;defaultPort&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;((&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Protocol&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ExtensionLoader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getExtensionLoader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Protocol&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;).&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getExtension&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)).&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getDefaultPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//如果配置port为null或者0，则会使用默认端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;defaultPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//如果配置port为null或者小于0（例如-1）则使用自动端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#7f848e&#34;&gt;//获取随机端口，从缓存中取
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;getRandomPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;          	&lt;span style=&#34;color:#7f848e&#34;&gt;//如果获取端口为空，则以默认端口为基准，按顺序取最近一个可用的端口
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;NetUtils&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getAvailablePort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;defaultPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;              &lt;span style=&#34;color:#7f848e&#34;&gt;//添加到随机端口的port的map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;putRandomPort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;logger&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;warn&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Use random available port(&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;) for protocol &amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;进一步查看NetUtils.getAvailablePort(defaultPort)方法，代码如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;getAvailablePort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;getAvailablePort&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;i&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;65535&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;++&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;ServerSocket&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ss&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;				&lt;span style=&#34;color:#7f848e&#34;&gt;//循环创建端口，假如端口被占用抛出异常并继续循环
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;              	&lt;span style=&#34;color:#7f848e&#34;&gt;//当获取到可用端口后返回
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#c678dd&#34;&gt;try&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e06c75&#34;&gt;ss&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ServerSocket&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e5c07b&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;var5&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;i&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;var5&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;catch&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;IOException&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;var13&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;finally&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ss&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;                        &lt;span style=&#34;color:#c678dd&#34;&gt;try&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;                            &lt;span style=&#34;color:#e06c75&#34;&gt;ss&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;close&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;                        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;catch&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;IOException&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;var12&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;                        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;26&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;27&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看使用了哪些端口&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;lsof -i|grep 5083(dubbo服务进程)|grep LISTEN 
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;使用固定还是随机&#34;&gt;使用固定还是随机&lt;/h2&gt;
&lt;p&gt;需要注意的是，dubbo文档的推荐用法指出：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;使用固定端口暴露服务，而不要使用随机端口&lt;/p&gt;
&lt;p&gt;这样在注册中心推送有延迟的情况下，消费者通过缓存列表也能调用到原地址，保证调用成功。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我理解的场景是假如我们使用随机端口，启动了提供者，假如我们使用随机端口，随机到的端口20880,那么注册中心提供给消费者的端口为20080；当我们因为要更新提供者，并将提供者重启并使用了随机端口的方式，那么这次端口为30080，因为注册中心通知延迟，可能使用30080的提供者已经启动完毕，但是消费者没有收到通知，所以依然使用缓存的20080调用就会出错。&lt;/p&gt;
&lt;p&gt;那么使用固定端口20080就不会有这个问题。&lt;/p&gt;
&lt;p&gt;但是考虑实际场景和配置的复杂度，我们对接口调用的实时性应该是没有这么高的。&lt;/p&gt;
&lt;p&gt;假如后期使用了容器化，每个dubbo应用作为一个容器的话，端口问题也可以得到比较好的解决。&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/backend/dubbo/dubbo-random-port/</guid>
      <pubDate>Wed, 01 Apr 2020 23:17:02 +0800</pubDate>
    </item>
    
    <item>
      <title>nacos作为配置中心的使用</title>
      <link>https://haigeek.me/posts/backend/microservice/nacos-base-learn/</link>
      <description>&lt;p&gt;nacos的初步认识与使用&lt;/p&gt;
&lt;h2 id=&#34;什么是nacos&#34;&gt;什么是nacos&lt;/h2&gt;
&lt;p&gt;来自官网的介绍：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们主要使用nacos的配置中心功能，关于配置中心的功能介绍如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。&lt;/p&gt;
&lt;p&gt;动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。&lt;/p&gt;
&lt;p&gt;配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;nacos作为配置中心已经经过了多个版本的迭代，目前处于稳定阶段。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20191231112730110.png&#34;
  alt=&#34;image-20191231112730110&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;图片源自nacos官方文档：https://nacos.io/zh-cn/docs/feature-list.html&lt;/p&gt;
&lt;h2 id=&#34;安装部署&#34;&gt;安装部署&lt;/h2&gt;
&lt;p&gt;首先去 &lt;a href=&#34;https://github.com/alibaba/nacos/releases&#34;&gt;https://github.com/alibaba/nacos/releases&lt;/a&gt; 下载最新的 release 包，然后解压。&lt;/p&gt;
&lt;p&gt;nacos的安装分两种安装方式：&lt;/p&gt;
&lt;h3 id=&#34;standalone-模式&#34;&gt;standalone 模式&lt;/h3&gt;
&lt;p&gt;在linux下的启动方式：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sh bin/startup.sh -m standalone
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在Windows下启动：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cmd bin/startup.cmd -m standalone
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后在 http://localhost:8848/nacos/index.html 进入控制台，nacos说明已经启动成功。&lt;/p&gt;
&lt;h3 id=&#34;cluster-模式&#34;&gt;cluster 模式&lt;/h3&gt;
&lt;p&gt;集群模式需要依赖 MySQL，然后修改对用的配置文件。具体的安装方式不再赘述，官方文档有比较清晰的安装步骤。&lt;/p&gt;
&lt;p&gt;在我们的单个项目，推荐使用standlone模式启动，不需要进行额外的数据库配置，nacos直接使用内置的数据库启动，部署起来非常方便。&lt;/p&gt;
&lt;h3 id=&#34;nacos的配置存储位置&#34;&gt;nacos的配置存储位置&lt;/h3&gt;
&lt;h4 id=&#34;服务端&#34;&gt;服务端&lt;/h4&gt;
&lt;p&gt;单体的nacos使用数据库Derby(Derby 是 Java 编写的数据库，属于 Apache 的一个开源项目)来进行数据的存储。存储路径在NACOS_PATH/data/derby-data&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200107133626567.png&#34;
  alt=&#34;image-20200107133626567&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;在实际使用的时候发现nacos直接复制程序文件夹到新的位置进行使用的时候，&lt;strong&gt;存储的数据也会直接复制过去&lt;/strong&gt;，在启动之后可以直接使用保存好的数据。&lt;/p&gt;
&lt;h4 id=&#34;客户端&#34;&gt;客户端&lt;/h4&gt;
&lt;p&gt;nacos会将服务端的配置在本地缓存一份，默认位置在用户目录下的nacos文件夹：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200107140159728.png&#34;
  alt=&#34;image-20200107140159728&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;缓存位置需要客户端在启动时使用-D参数进行指定&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;-DJM.SNAPSHOT.PATH=xxx
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;系统集成与使用&#34;&gt;系统集成与使用&lt;/h2&gt;
&lt;h3 id=&#34;nacos相关配置概念&#34;&gt;nacos相关配置概念&lt;/h3&gt;
&lt;p&gt;nacos为我们提供了以下几个功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;配置管理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;服务管理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;命名空间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;集群管理&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200103141809972.png&#34;
  alt=&#34;image-20200103141809972&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;其中服务管理按照设计是可以支持dubbo服务注册，替代zookeeper作为新的注册中心，但是我们目前使用dubbo版本的不支持使用nacos，因此我们主要使用nacos的配置管理功能。&lt;/p&gt;
&lt;p&gt;nacos支持集群部署，在集群管理部署的情况下可以查看集群的节点。&lt;/p&gt;
&lt;p&gt;主要介绍下命名空间和配置管理功能&lt;/p&gt;
&lt;h4 id=&#34;命名空间&#34;&gt;命名空间&lt;/h4&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200103141952914.png&#34;
  alt=&#34;image-20200103141952914&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;官方对命名空间的介绍：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在日常使用中常常需要不同的环境，比如日常，预发，线上环境，如果是逻辑隔离可以使用命名空间，Nacos支持命名空间来支持多环境隔离，可以在Nacos控制台创建多个命名空间。如果需要物理隔离，就要部署多套Nacos环境。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;命名空间主要用来进行满足多环境的差异性配置。我们可以定义dev、test、release、prod等命名空间来进行使用。&lt;/p&gt;
&lt;p&gt;当无妨访问全局配置中心的时候且需要进行开发时，依旧可以使用传统的配置方式，将配置文件放置在本地进行开发。&lt;/p&gt;
&lt;p&gt;因此建议在本地开发的时候，application-dev.yml使用正常的本地配置，将其他环境的配置迁移到全局配置中心。&lt;/p&gt;
&lt;h4 id=&#34;配置管理&#34;&gt;配置管理&lt;/h4&gt;
&lt;p&gt;在nacos配置中有几个核心的概念：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DataID：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nacos 中的某个配置集的 ID。配置集 ID 是组织划分配置的维度之一。Data ID 通常用于组织划分系统的配置集。一个系统或者应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识。Data ID 通常采用类 Java 包（如 com.taobao.tc.refund.log.level）的命名规则保证全局唯一性。此命名规则非强制。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Group：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nacos 中的一组配置集，是组织配置的维度之一。通过一个有意义的字符串（如 Buy 或 Trade ）对配置集进行分组，从而区分 Data ID 相同的配置集。配置分组的名称默认采用 DEFAULT_GROUP 。配置分组的常见场景：不同的应用或组件使用了相同的配置类型，如 database_url 配置和 MQ_topic 配置。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;配置快照：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nacos 的客户端 SDK 会在本地生成配置的快照。当客户端无法连接到 Nacos Server 时，可以使用配置快照显示系统的整体容灾能力。配置快照类似于 Git 中的本地 commit，也类似于缓存，会在适当的时机更新，但是并没有缓存过期（expiration）的概念。&lt;/p&gt;
&lt;h3 id=&#34;nacos配置管理其他功能&#34;&gt;nacos配置管理其他功能&lt;/h3&gt;
&lt;h4 id=&#34;配置版本历史管理&#34;&gt;配置版本历史管理&lt;/h4&gt;
&lt;p&gt;在配置文件修改完成点击发布的时候，nacos会对比本次更新与上次更新；&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200103164500763.png&#34;
  alt=&#34;image-20200103164500763&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;同时针对一份配置文件可以查询配置的历史，历史保留30天，可以选中某一个版本进行回滚&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200103164621353.png&#34;
  alt=&#34;image-20200103164621353&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h4 id=&#34;配置监听查询&#34;&gt;配置监听查询&lt;/h4&gt;
&lt;p&gt;nacos具有配置修改实时推送到客户端的功能，其背后的实现机制是一个HttpAgent来访问server暴露的http服务来获取配置文件的更新。在nacos的管理端，可以查询某个配置被那些客户端监听&lt;/p&gt;
&lt;h3 id=&#34;配置文件迁移到nacos&#34;&gt;配置文件迁移到nacos&lt;/h3&gt;
&lt;p&gt;基于nacos的设计，将本地的配置文件迁移到nacos有两种方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;整体搬运配置文件到nacos，将原有的本地的配置文件赋予一个dataID和group然后整体复制到nacos&lt;/li&gt;
&lt;li&gt;根据实际情况只将部分配置放在配置中心，使用类 Java 包（如 com.taobao.tc.refund.log.level）的命名规则保证全局唯一性&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;nacos的配置文件支持以下格式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TEXT&lt;/li&gt;
&lt;li&gt;JSON&lt;/li&gt;
&lt;li&gt;XML&lt;/li&gt;
&lt;li&gt;YAML&lt;/li&gt;
&lt;li&gt;HTML&lt;/li&gt;
&lt;li&gt;Properties&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;值得一提的是nacos的配置编辑器是vscode的在线版，对文件的高亮支持、文件的内容查找都有和本地编辑相同的体验，在修改配置文件时一定程度了减少了出错的概率。&lt;/p&gt;
&lt;h3 id=&#34;集成到springboot项目&#34;&gt;集成到SpringBoot项目&lt;/h3&gt;
&lt;p&gt;在springboot中集成nacos作为配置中心非常简单，需要进行以下几个步骤的操作：&lt;/p&gt;
&lt;p&gt;1、引入pom文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.alibaba.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;nacos-config-spring-boot-starter&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;0.1.4&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此处的版本0.1.4是针对springboot1.x的版本，对于springboot2.x，可以直接使用最新的版本，目前官方给出的最新版本是0.2.4&lt;/p&gt;
&lt;h4 id=&#34;配置方式一全局配置&#34;&gt;配置方式一：全局配置&lt;/h4&gt;
&lt;p&gt;在配置文件加入如下配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;nacos&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;server-addr&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;127.0.0.1&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;8848&lt;/span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;#nacos配置中心的地址&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;data-ids&lt;/span&gt;: application-dev.yml &lt;span style=&#34;color:#7f848e&#34;&gt;#在nacos中配置的dataid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;group&lt;/span&gt;: dgp-dis-server-web &lt;span style=&#34;color:#7f848e&#34;&gt;#在nacos配置的group&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;auto-refresh&lt;/span&gt;: &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;#自动刷新配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;bootstrap&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#e06c75&#34;&gt;log-enable&lt;/span&gt;: &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;#打印配置变更日志&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;type&lt;/span&gt;: yaml &lt;span style=&#34;color:#7f848e&#34;&gt;#必须填写&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;namespace&lt;/span&gt;: 7a4fe144-3303-4013-b259-fdc8ecd0394d &lt;span style=&#34;color:#7f848e&#34;&gt;#此处必须是namespace的命名空间id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;将其他配置转移到nacos配置中心。&lt;/p&gt;
&lt;p&gt;此配置方式等效于在springboot的启动类上加上@NacosPropertySource注解&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@SpringBootApplication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@NacosPropertySource&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;dataId&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;application-dev.yml&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;groupId&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;dgp-dis-server-web&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;autoRefreshed&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;NacosConfigApplication&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;main&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;args&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;SpringApplication&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;run&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;NacosConfigApplication&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;args&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在配置中心加入下面的配置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;useLocalCache&lt;/span&gt;: &lt;span style=&#34;color:#e5c07b&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在需要使用nacos的数据时，可以借助@NacosValue注解&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt; &lt;span style=&#34;color:#61afef&#34;&gt;@NacosValue&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;${useLocalCache:false}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;autoRefreshed&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;boolean&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;useLocalCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt; &lt;span style=&#34;color:#61afef&#34;&gt;@RequestMapping&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/get&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;method&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;RequestMethod&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;GET&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#61afef&#34;&gt;@ResponseBody&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;boolean&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;get&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;useLocalCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;配置方式二灵活的局部配置&#34;&gt;配置方式二：灵活的局部配置&lt;/h4&gt;
&lt;p&gt;在整体配置的基础上，可以对实体代码进行配置，如下所示&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@NacosConfigurationProperties&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;prefix&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;apple&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;dataId&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;apple&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ConfigType&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;YAML&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;autoRefreshed&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@Configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;Apple&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;getList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;		&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;setList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;		&lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;getListMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;		&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;setListMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;		&lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#61afef&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;26&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;toString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;27&lt;/span&gt;&lt;span&gt;		&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Apple{&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;list=&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;, listMap=&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;28&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;29&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在nacos配置中心加上如下的配置：&lt;/p&gt;
&lt;p&gt;DataId：apple&lt;/p&gt;
&lt;p&gt;Group：DEFAULT_GROUP&lt;/p&gt;
&lt;p&gt;配置内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apple&lt;/span&gt;: 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;list&lt;/span&gt;: 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;    - &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;    - &lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;    - &lt;span style=&#34;color:#d19a66&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;listMap&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;k1&lt;/span&gt;: 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;      - &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;      - &lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;k2&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;      -&lt;span style=&#34;color:#d19a66&#34;&gt;3&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;      -&lt;span style=&#34;color:#d19a66&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;获取配置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Apple&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;apple&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@GetMapping&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/apple&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ResponseBody&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;getApplr&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;apple&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;在代码中更新配置&#34;&gt;在代码中更新配置&lt;/h4&gt;
&lt;p&gt;nacos提供了发布配置到配置中心的接口，可以在特定的场景进行配置发布操作&lt;/p&gt;
&lt;p&gt;发布主要借助configService这个核心类&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@NacosInjected&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ConfigService&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;configService&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt; * 发布配置 content需要为全量数据
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt; * @return
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt; * @throws NacosException
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@GetMapping&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/publish&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ResponseBody&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Boolean&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;publishConfig&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;NacosException&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;configService&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;publishConfig&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;example&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;DEFAULT_GROUP&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;useLocalCache=false\n&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;people.enable=testPublish&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;@NacosInjected 是一个核心注解，用于在Spring Beans 中注入 ConfigService，ConfigService支持的功能如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;images/image-20200107110503874.png&#34;
  alt=&#34;image-20200107110503874&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h4 id=&#34;多环境配置&#34;&gt;多环境配置&lt;/h4&gt;
&lt;p&gt;针对多环境的配置，nacos提供了命名空间来应对这个场景。&lt;/p&gt;
&lt;p&gt;在配置文件加入如下配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;nacos&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;namespace&lt;/span&gt;: 7a4fe144-3303-4013-b259-fdc8ecd0394d
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;需要注意的是&lt;strong&gt;这里的namespace需要使用guid而不是名称&lt;/strong&gt;。&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/backend/microservice/nacos-base-learn/</guid>
      <pubDate>Wed, 08 Jan 2020 22:31:21 +0800</pubDate>
    </item>
    
    <item>
      <title>2019掠影</title>
      <link>https://haigeek.me/posts/life/2019-life-summary/</link>
      <description>&lt;p&gt;2019年度总结&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzI4MjQ4MzAzMg==&amp;amp;mid=2247483834&amp;amp;idx=1&amp;amp;sn=3ad0efc7d166165671f6ba0dff493a02&amp;amp;chksm=eb98018ddcef889b9ee1796909f3177fc50f0b91d29cb5229471fc47a4897da21d39416b1981&amp;amp;token=1478250301&amp;amp;lang=zh_CN#rd&#34;&gt;2019掠影&lt;/a&gt;&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/life/2019-life-summary/</guid>
      <pubDate>Sun, 29 Dec 2019 22:34:23 +0800</pubDate>
    </item>
    
    <item>
      <title>并发登录下session的处理</title>
      <link>https://haigeek.me/posts/java/spring/concurrent-login-session/</link>
      <description>&lt;p&gt;在进行性能测试的时候并发请求登录接口时候出现失败的情况，对排查记录做一下总结。&lt;/p&gt;
&lt;h1 id=&#34;并发登录下session的处理&#34;&gt;并发登录下session的处理&lt;/h1&gt;
&lt;h2 id=&#34;问题&#34;&gt;问题&lt;/h2&gt;
&lt;p&gt;在进行性能测试的时候并发请求登录接口，除登录接口之外的接口保护策略是使用过滤器从cookie获取用户信息并和服务端进行后续的数据交互。&lt;/p&gt;
&lt;p&gt;设置一个线程组，线程主要有两个接口&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;登录接口，登录成功之后系统会返回一个set-cookie的响应头&lt;/li&gt;
&lt;li&gt;调用被保护的接口，接口在请求时会携带cookie来让服务器鉴别当前请求是否合法&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;线程组的具体设置如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://i.loli.net/2019/12/23/ZKRoBQOF3mna4rd.png&#34;
  alt=&#34;image-20190925090956992&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;标记为3 的接口访问进行了用户鉴权。&lt;/p&gt;
&lt;p&gt;当执行此线程组一次的时候，运行正常，运行结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://i.loli.net/2019/12/23/GZJfDqMyQnEYVB8.png&#34;
  alt=&#34;image-20190924231443836&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;将线程组的线程数调整为2，Rame-Up（线程启动时间间隔）设置为1s，两组线程执行正常，运行结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/SaeMhTqpGtWzQC1.png&#34;
  alt=&#34;image-20190925091109920&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;可以看到执行顺序是按照我们1、2、3依次执行的顺序，因为1s的间隔较长，在线程1执行完毕之后线程2执行。&lt;/p&gt;
&lt;p&gt;将线程组的线程数调整为2，Rame-Up（线程启动时间间隔）设置为0.1s，接口请求出现异常，运行结果如下：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/FqWciCT8SyNpdkY.png&#34;
  alt=&#34;image-20190925091517378&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;在这次请求可以看到，两个线程同时出发，模拟了系统可以存在的并发情况，可以确认的是第二个用户的确登录成功但是在与后台进行校验的时候出现了问题。&lt;/p&gt;
&lt;h2 id=&#34;分析&#34;&gt;分析&lt;/h2&gt;
&lt;p&gt;通过报错的接口的异常信息定位到代码的位置是在从session中取用户信息的时候出现了错误。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/qIUNv1gCSjBc7nx.png&#34;
  alt=&#34;image-20190925092015591&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;框选的代码为报错行，联系上下文猜测session并没有获取成功或session不存在。因此加入箭头所指代码进行debug。&lt;/p&gt;
&lt;p&gt;发现在此处会报空指针异常，但是session是确实存在的。&lt;/p&gt;
&lt;p&gt;检查redis中存储的session信息，发现有一个session缺少要存储的用户等关键信息&lt;/p&gt;
&lt;p&gt;不完整的session信息：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/OPQzvkhIlVrwZWR.png&#34;
  alt=&#34;不完整session&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;存储正常的session信息：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/cfnIAq1gQChoLG4.png&#34;
  alt=&#34;image-20190925092738929&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;因此定位到是session在存储的时候出了问题。&lt;/p&gt;
&lt;h2 id=&#34;解决&#34;&gt;解决&lt;/h2&gt;
&lt;p&gt;检查session存储的代码，发现登录接口使用的session是一个共享的变量，因为 spring 的每个 controller 默认都是单例的，这个session 会被其他线程给共享，在多线程的情况下，极容易出现线程不安全的问题。&lt;/p&gt;
&lt;p&gt;现有的session处理方式如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ModelAttribute&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;init&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;	&lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//登录controller
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt; &lt;span style=&#34;color:#61afef&#34;&gt;@PostMapping&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;public/client-account/v1/login-dev&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ApiOperation&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;用户登录校验(明文)&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ResponseData&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;loginDev&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@RequestBody&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;OmsLoginDTO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;loginDTO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;OmsUserVO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;userFacade&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;checkLogin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;loginDTO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;userFacade&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;log&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;sessionCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ResponseUtil&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;success&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * 缓存用户session
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @param omsUserVO
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @throws Exception
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;sessionCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsUserVO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;repeatLogin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;equals&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;26&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;FindByIndexNameSessionRepository&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;PRINCIPAL_NAME_INDEX_NAME&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getLoginName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;27&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;28&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;29&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;size&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;30&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;stream&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;31&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsRoleVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoleName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;32&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;collect&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Collectors&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;33&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;34&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;35&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;解决方式有三种：&lt;/p&gt;
&lt;p&gt;首先介绍最简单的一种，&lt;/p&gt;
&lt;h4 id=&#34;使用autowired注解&#34;&gt;使用@Autowired注解&lt;/h4&gt;
&lt;p&gt;使用@Autowired代替@ModelAttribute&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//@ModelAttribute
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//public void init(HttpSession httpSession, HttpServletRequest request) {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#7f848e&#34;&gt;//this.session = httpSession;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#7f848e&#34;&gt;//this.request = request;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对上述代码进行调试&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/K8FQeTgMwufvoil.png&#34;
  alt=&#34;image-20190925110213553&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;加上了@Autowired注解之后进行debug发现，request并不是原始的HttpServletRequest对象，而是HttpServletRequest的一个代理类。找到代理类的实现如下&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/HIjl3nckNPm8Ddw.png&#34;
  alt=&#34;image-20190925110822925&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;实际上Autowire进来的并不是原始的HttpServletRequest对象，而是HttpServletRequest的一个代理类。实际上它会通过&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;到这一步骤已经很明显了，那如何看出是线程安全的，继续往下看。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/SvHB7gA4CbhTNMt.png&#34;
  alt=&#34;image-20190925110859572&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;进一步去看RequestContextHolder发现RequestContextHolder是通过ThreadLocal来实现的，可以保证每个线程获取得到的Request对象一定是当前请求的Request对象，从而保证线程安全。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/7bu9BqrfIQxmLjo.png&#34;
  alt=&#34;image-20190925111025094&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h4 id=&#34;一种是在登录相关接口将session作为参数传递到方法中使用&#34;&gt;一种是在登录相关接口将session作为参数传递到方法中使用&lt;/h4&gt;
&lt;p&gt;在请求和存储的时候加上单独的HttpSession session&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@PostMapping&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;public/client-account/v1/login-dev&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ApiOperation&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;用户登录校验(明文)&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ResponseData&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;loginDev&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@RequestBody&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;OmsLoginDTO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;loginDTO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;OmsUserVO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;userFacade&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;checkLogin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;loginDTO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;userFacade&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;log&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;sessionCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ResponseUtil&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;success&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * 缓存用户session
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @param omsUserVO
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @throws Exception
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;sessionCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsUserVO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;repeatLogin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;equals&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;FindByIndexNameSessionRepository&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;PRINCIPAL_NAME_INDEX_NAME&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getLoginName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;size&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;stream&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsRoleVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoleName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;collect&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Collectors&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;26&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;27&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;另外一种是将session使用threadlocal来处理&#34;&gt;另外一种是将session使用ThreadLocal来处理&lt;/h4&gt;
&lt;p&gt;重点在于session的初始化设置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;final&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ThreadLocal&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ThreadLocal&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@ModelAttribute&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;init&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpSession&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;ClientAccountController&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;set&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;httpSession&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;//在涉及到session的获取时候需要使用session.get()
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * 缓存用户session
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @param omsUserVO
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     * @throws Exception
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;sessionCache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsUserVO&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Exception&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;repeatLogin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;equals&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;get&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;FindByIndexNameSessionRepository&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;PRINCIPAL_NAME_INDEX_NAME&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getLoginName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;get&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#c678dd&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;size&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;List&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;omsUserVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoles&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;stream&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;map&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;OmsRoleVO&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;::&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getRoleName&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;collect&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Collectors&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;session&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;get&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAttribute&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;JSONObject&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;toJSONString&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;roleNameList&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用上述三种方式任意方式之后，最终请求正常&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/lo4m7psr3f2AM96.png&#34;
  alt=&#34;image-20190925094039469&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;继续调整请求线程为10，问题没有出现。&lt;/p&gt;
&lt;h2 id=&#34;总结&#34;&gt;总结&lt;/h2&gt;
&lt;p&gt;1、在并发的情况下要注意考虑共享变量的问题&lt;/p&gt;
&lt;p&gt;2、request、Response、session在单例controller是不安全的，采用ThreadLocal可以解决该问题。推荐直接使用spring帮助我们处理好的来使用。&lt;/p&gt;
&lt;p&gt;3、建议修改现有的baseController。&lt;/p&gt;
&lt;p&gt;参考链接：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/kismetv/p/8757260.html#t4&#34;&gt;https://www.cnblogs.com/kismetv/p/8757260.html#t4&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://segmentfault.com/q/1010000005139036&#34;&gt;https://segmentfault.com/q/1010000005139036&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/java/spring/concurrent-login-session/</guid>
      <pubDate>Wed, 16 Oct 2019 23:26:39 +0800</pubDate>
    </item>
    
    <item>
      <title>一次Tcp端口耗尽引发的思考</title>
      <link>https://haigeek.me/posts/computerscience/tcp-socker-no-buffer-space-available/</link>
      <description>&lt;p&gt;tcp在实际的使用中，客户端和服务端可能都会出现端口不够用的情况，重新温习了一下tcp的四次挥手来寻找这个问题出现的原因。&lt;/p&gt;
&lt;h1 id=&#34;一次tcp端口耗尽引发的思考&#34;&gt;一次Tcp端口耗尽引发的思考&lt;/h1&gt;
&lt;h2 id=&#34;起因&#34;&gt;起因&lt;/h2&gt;
&lt;p&gt;访问接口服务端既不报错但是也无响应，登录服务器查看后台有报错，报错的堆栈的信息大致为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Caused&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;by&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;net&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;SocketException&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;No&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;buffer&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;space&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;available&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;maximum&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connections&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;reached&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;?):&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connect&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;AxisFault&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;makeFault&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;AxisFault&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;101&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;transport&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;http&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HTTPSender&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HTTPSender&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;154&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;strategies&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;InvocationStrategy&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;visit&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;InvocationStrategy&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;32&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;SimpleChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;doVisiting&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;SimpleChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;118&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;SimpleChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;SimpleChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;83&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;AxisClient&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;AxisClient&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;165&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invokeEngine&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2784&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2767&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2443&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2366&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;at&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;axis&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;invoke&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Call&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;java&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;1812&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;问题分析&#34;&gt;问题分析&lt;/h2&gt;
&lt;p&gt;从报错信息来看是socket端口使用数已经超过了最发限度，定位到应该是服务器的原因，尝试请求这台服务器部署的其他应用，对于的后台也会报相同的错误。基本可以定位到是因为可用的socket端口不足的原因。&lt;/p&gt;
&lt;p&gt;那么为什么会出现这个情况呢？&lt;/p&gt;
&lt;p&gt;出现这种情况，我们可以使用命令 &lt;code&gt;netstat -at&lt;/code&gt;来查看一下当前系统下端口的连接状况，可以发现此时会有很多的端口会处于TIME_WAIT的状态，处于这个状态的端口是无法释放的，因此系统并发过大，连接数过多，部分socket连接无法释放关闭，而持续请求又导致无法释放的socket连接不断积压，最终导致No buffer space available。&lt;/p&gt;
&lt;p&gt;我们重新来温习一下TCP连接的三次握手和挥手&lt;/p&gt;
&lt;h3 id=&#34;tcp连接的三次握手和挥手&#34;&gt;TCP连接的三次握手和挥手&lt;/h3&gt;
&lt;h4 id=&#34;三次握手&#34;&gt;三次握手&lt;/h4&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/akyU7GwuMEoQ64N.png&#34;
  alt=&#34;&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;tcp的三次握手的流程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;客户端发送SYN标志位为1，seq（Sequence Number）为x的连接请求报文，然后客户端进入SYN_SEND状态，等待服务器端的确认响应。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;服务端收到客户端的请求，对这个SYN报文进行确认，发送ACK（Acknowledgment Number）为x+1（Sequence+1），SYN和ACK的标志位均为1，seq为y的报文段为y的报文段（即SYN+ACK的报文段），此时服务端进入SYN_RECV状态&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;客户端收到服务器的SYN+ACK报文段，确认ACK后，发送ACK为y+1，SYN标志位为0，ACK标志位为1的报文段，发送完成后，客户端和服务器端都进入ESTABLISHED状态，完成TCP三次握手，客户端和服务器端成功地建立连接，可以开始传输数据了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;四次挥手&#34;&gt;四次挥手&lt;/h4&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/2iUhyBfPW7duI8V.png&#34;
  alt=&#34;tcp-bye&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;tcp的四次挥手的流程如下：&lt;/p&gt;
&lt;p&gt;连接可以由客户端或者服务端发起，这里以客户端发起为例：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;客户端发送Seq为x+2，Ack为y+1的FIN报文段，客户端进入FIN_WAIT_1状态，即告诉服务端没有数据需要传输了，请求关闭连接；&lt;/li&gt;
&lt;li&gt;服务端收到客户端的FIN报文段后，向客户端应答一个Ack为Seq+1（即x+3）的ACK报文段，即告诉客户端你的请求我收到了，但是我还没准备好，请等待我的关闭请求。客户端收到后进入FIN_WAIT_2状态；&lt;/li&gt;
&lt;li&gt;服务端完成数据传输后向客户端发送Seq为y+1的FIN报文段，请求关闭连接，服务器进入LAST_ACK状态；&lt;/li&gt;
&lt;li&gt;客户端收到服务端的FIN报文段后，向服务端应答一个Ack为Seq+1的ACK报文段，然后客户端进入TIME_WAIT状态；服务端收到客户端的ACK报文段后关闭连接进入CLOSED状态，客户端等待2MSL（2 Max Segment Lifetime）后依然没有收到回复，则证明服务端已正常关闭，客户端此时关闭连接进入CLOSED状态。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;为什么有time_wait的状态&#34;&gt;为什么有TIME_WAIT的状态&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;确保最终的ACK已经到达；&lt;/p&gt;
&lt;p&gt;假如最终的ACK丢失，那么服务端会重新发送FIN，当最终的ACK在1个MSL没有到达，那么在下一个MSL里重新发送的FIN需要到达，客户端必须维护TCP状态信息以便可以重发最终的ACK，否则会发送RST，结果服务端认为发生错误。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;防止延迟的无效消息包被误认为是合法的&lt;/p&gt;
&lt;p&gt;假如客户端A和服务端B在传输数据，假如传输了一节数据，因为网络的原因发生了延迟，在未到达B的时候，AB就已经关闭了传输通道。然后AB马上又重新建立起一个相同的IP地址和端口之间的TCP连接，那么这个延迟的数据包是有可能重新到达的，这样就引起了混乱。处于TIME_WAIT的端口是不允许创建新的连接的，2MSL可以保证这个丢失的数据可以失效。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在centos下可以使用&lt;code&gt;sysctl -a|grep net.ipv4.tcp_fin_timeout&lt;/code&gt;查看超时时间&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;net.ipv4.tcp_fin_timeout = 60
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;本地有多少端口可用&#34;&gt;本地有多少端口可用&lt;/h3&gt;
&lt;p&gt;TCP协议中&lt;code&gt;PORT&lt;/code&gt;部分是用两个字节来表示的，也就是说可用的端口数量肯定不能超过65536个。
另外，这其中还有些端口是系统保留的，需要root权限才可以使用的，在CentOS系统中，client端可以使用的端口可以通过&lt;code&gt;sysctl -a|grep net.ipv4.ip_local_port_range&lt;/code&gt;来查看&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;net.ipv4.ip_local_port_range &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; 32768	&lt;span style=&#34;color:#d19a66&#34;&gt;60999&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;单机请求的qps&#34;&gt;单机请求的QPS&lt;/h3&gt;
&lt;p&gt;如果client机器有32768端口可用，TIME_WAIT 60秒，短连接的方式发起请求，那么这个client发起的请求的QPS是不能超过28233/60的&lt;/p&gt;
&lt;h2 id=&#34;问题解决&#34;&gt;问题解决&lt;/h2&gt;
&lt;p&gt;以下设置需要根据Windows和linux系统使用对应的命令去设置。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;解决问题最快的方式是重启服务器，可以释放大量的端口，但是弊端也比较明显&lt;/li&gt;
&lt;li&gt;检查代码中webservice或httpclient调用未进行连接释放，导致资源无法回收。&lt;/li&gt;
&lt;li&gt;修改系統默认的TIMEOUT时间&lt;/li&gt;
&lt;li&gt;打开&lt;code&gt;tcp_tw_reuse&lt;/code&gt;也就是允许将TIME-WAIT sockets重新用于新的TCP连接，打开这个选项之后，TCP包里面会带上发包机器的当前时间戳&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;windows 系统处理方式&lt;/p&gt;
&lt;p&gt;通过regedit启动注册表编译器找到如下路径：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加参数：&lt;/p&gt;
&lt;p&gt;(1)新建&lt;/p&gt;
&lt;p&gt;值名称：MaxUserPort&lt;/p&gt;
&lt;p&gt;值类型：DWORD&lt;/p&gt;
&lt;p&gt;值数据：65534（十六进制是FFFE）&lt;/p&gt;
&lt;p&gt;有效范围：5000 - 65534 (十进制)&lt;/p&gt;
&lt;p&gt;默认：0x1388 5000（十进制）&lt;/p&gt;
&lt;p&gt;(2)新建&lt;/p&gt;
&lt;p&gt;值名称：TCPTimedWaitDelay&lt;/p&gt;
&lt;p&gt;值类型：DWORD&lt;/p&gt;
&lt;p&gt;值数据：0000001e（30）&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/computerscience/tcp-socker-no-buffer-space-available/</guid>
      <pubDate>Wed, 08 May 2019 22:38:38 +0800</pubDate>
    </item>
    
    <item>
      <title>springboot全局跨域与过滤器跨域</title>
      <link>https://haigeek.me/posts/java/springboot/springboot-filter-cros/</link>
      <description>&lt;p&gt;当项目中使用了过滤器的时候,使用springboot全局跨域设置有时候并不能满足我们的需求,具体表现为明明设置了全局允许跨域,前端同学依旧说我们的接口不允许跨域。&lt;/p&gt;
&lt;h2 id=&#34;跨域请求&#34;&gt;跨域请求&lt;/h2&gt;
&lt;p&gt;浏览器具有同源限制，即完全一致的意思是，域名要相同（&lt;code&gt;www.example.com&lt;/code&gt;和&lt;code&gt;example.com&lt;/code&gt;不同），协议要相同（&lt;code&gt;http&lt;/code&gt;和&lt;code&gt;https&lt;/code&gt;不同），端口号要相同（默认是&lt;code&gt;:80&lt;/code&gt;端口，它和&lt;code&gt;:8080&lt;/code&gt;就不同）&lt;/p&gt;
&lt;h2 id=&#34;使用cros处理跨域&#34;&gt;使用CROS处理跨域&lt;/h2&gt;
&lt;p&gt;Origin表示本域，也就是浏览器当前页面的域。当JavaScript向外域（如sina.com）发起请求后，浏览器收到响应后，首先检查&lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;是否包含本域，如果是，则此次跨域请求成功，如果不是，则请求失败，JavaScript将无法获取到响应的任何数据。&lt;/p&gt;
&lt;p&gt;跨域能否成功，取决于对方服务器是否愿意给你设置一个正确的&lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt;，决定权始终在对方手中。&lt;/p&gt;
&lt;h5 id=&#34;简单跨域请求&#34;&gt;简单跨域请求&lt;/h5&gt;
&lt;p&gt;上面这种跨域请求，称之为“简单请求”。简单请求包括GET、HEAD和POST（POST的Content-Type类型
仅限&lt;code&gt;application/x-www-form-urlencoded&lt;/code&gt;、&lt;code&gt;multipart/form-data&lt;/code&gt;和&lt;code&gt;text/plain&lt;/code&gt;），并且不能出现任何自定义头（例如，&lt;code&gt;X-Custom: 12345&lt;/code&gt;），通常能满足90%的需求。&lt;/p&gt;
&lt;h5 id=&#34;其他类型的请求&#34;&gt;其他类型的请求&lt;/h5&gt;
&lt;p&gt;对于PUT、DELETE以及其他类型如&lt;code&gt;application/json&lt;/code&gt;的POST请求，在发送AJAX请求之前，浏览器会先发送一个&lt;code&gt;OPTIONS&lt;/code&gt;请求（称为preflighted请求）到这个URL上，询问目标服务器是否接受：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;OPTIONS /path/to/resource HTTP/1.1
Host: bar.com
Origin: http://my.com
Access-Control-Request-Method: POST
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;服务器必须响应并明确指出允许的Method：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://my.com
Access-Control-Allow-Methods: POST, GET, PUT, OPTIONS
Access-Control-Max-Age: 86400
Access-Control-Allow-Credentials: true | false // 是否允许携带 Cookie
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;带cookie的跨域请求&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Access-Control-Allow-Credentials&lt;/code&gt; 响应头会使浏览器允许在 Ajax 访问时携带 Cookie，但我们仍然需要对 XMLHttpRequest 设置其 &lt;code&gt;withCredentials&lt;/code&gt; 参数，才能实现携带 Cookie 的目标。&lt;/p&gt;
&lt;p&gt;为了安全，标准里不允许 &lt;code&gt;Access-Control-Allow-Origin: *&lt;/code&gt;，必须指定明确的、与请求网页一致的域名。同时，Cookie 依然遵循“同源策略”，只有用目标服务器域名设置的 Cookie 才会上传，而且使用 &lt;code&gt;document.cookie&lt;/code&gt; 也无法读取目标服务器域名下的 Cookie。&lt;/p&gt;
&lt;h2 id=&#34;springboot设置跨域&#34;&gt;Springboot设置跨域&lt;/h2&gt;
&lt;p&gt;可以在服务端设置允许跨域访问，设置如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#61afef&#34;&gt;@Configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;CorsConfig&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#61afef&#34;&gt;@Bean&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;CorsFilter&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;corsFilter&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//1.添加CORS配置信息
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;CorsConfiguration&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;CorsConfiguration&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//放行哪些原始域
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;addAllowedOrigin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//是否发送Cookie信息
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setAllowCredentials&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//放行哪些原始域(请求方式)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;addAllowedMethod&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//放行哪些原始域(头部信息)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;addAllowedHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//2.添加映射路径
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;UrlBasedCorsConfigurationSource&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;configSource&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;UrlBasedCorsConfigurationSource&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;configSource&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;registerCorsConfiguration&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/**&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;config&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//3.返回新的CorsFilter.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;CorsFilter&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;configSource&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在实际的实践中发现，上述处理方式可以解决大多数情况下的跨域问题，但是当客户端的请求带有cookies时，我们就不能使用简单的通配符*来处理跨域问题，会发现上述的springboot跨域设置失效，针对这个问题，可以使用过滤器将请求的url进行拦截，重新设置响应头，就可以完成带cookie请求跨域的处理。&lt;/p&gt;
&lt;h2 id=&#34;拦截器处理跨域问题&#34;&gt;拦截器处理跨域问题&lt;/h2&gt;
&lt;p&gt;用filter拦截每次请求，如果携带身份信息(Credential)时，获取到具体的域响应给请求。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e5c07b&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#61afef;font-weight:bold&#34;&gt;doFilter&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;servletRequest&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;                         &lt;span style=&#34;color:#e06c75&#34;&gt;ServletResponse&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;servletResponse&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;                         &lt;span style=&#34;color:#e06c75&#34;&gt;FilterChain&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;filterChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;IOException&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;ServletException&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletRequest&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;servletRequest&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletResponse&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;response&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;HttpServletResponse&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;servletResponse&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//根据请求头设置响应头
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;allowOrigin&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Origin&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;String&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;allowHeader&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;getHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Access-Control-Request-Headers&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;allowOrigin&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;//设置允许带cookie的请求
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Access-Control-Allow-Credentials&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Access-Control-Allow-Methods&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;OPTIONS, POST, PUT, GET, OPTIONS, DELETE&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;setHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Access-Control-Allow-Headers&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;allowHeader&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;filterChain&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;doFilter&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;servletRequest&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;servletResponse&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在实际的项目中，全局的跨域设置处理与拦截器可以同时设置，针对带有cookie的请求，我们可以设置拦截器来进行处理，就可以很好的处理跨域问题。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;参考自：https://blog.csdn.net/u014029255/article/details/56842509&lt;/p&gt;
&lt;/blockquote&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/java/springboot/springboot-filter-cros/</guid>
      <pubDate>Sun, 06 Jan 2019 23:05:54 +0800</pubDate>
    </item>
    
    <item>
      <title>使用Maven Profile和Spring Profile进行多环境配置</title>
      <link>https://haigeek.me/posts/java/springboot/springboot-maven-profile/</link>
      <description>&lt;p&gt;Springboot使用Maven Profile和Spring Profile进行多环境配置&lt;/p&gt;
&lt;p&gt;在实际的项目上，一般会分三种环境dev、test、prod来方便我们的开发和部署，要求我们在开发的时候可以方便地进行环境的切换，又要满足在发布版本的时候可以尽可能减少测试人员的配置。&lt;/p&gt;
&lt;h1 id=&#34;springboot使用maven-profile和spring-profile进行多环境配置&#34;&gt;Springboot使用Maven Profile和Spring Profile进行多环境配置&lt;/h1&gt;
&lt;h2 id=&#34;目的&#34;&gt;目的&lt;/h2&gt;
&lt;p&gt;在实际的项目上，一般会分三种环境dev、test、prod来方便我们的开发和部署，要求我们在开发的时候可以方便地进行环境的切换，又要满足在发布版本的时候可以尽可能减少测试人员的配置。&lt;/p&gt;
&lt;h2 id=&#34;spring-profile&#34;&gt;Spring Profile&lt;/h2&gt;
&lt;h3 id=&#34;多环境&#34;&gt;多环境&lt;/h3&gt;
&lt;p&gt;为了实现多环境配置，我们可以在本地开发的时候在Resource文件夹下新建不同环境的配置文件，如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://ws1.sinaimg.cn/large/006tNc79gy1fz7mro00dyj30g404at95.jpg&#34;
  alt=&#34;&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;这时候我们只需要在主配置文件application.yml文件使用spring.profiles.active = dev/test/prod来进行不同环境的切换&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;spring:
  profiles:
    active: dev #加载dev配置文件
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;经过上述步骤，我们即可在本地开发时根据不同的环境进行测试。&lt;/p&gt;
&lt;h3 id=&#34;主配置文件与不同环境的配置文件&#34;&gt;主配置文件与不同环境的配置文件&lt;/h3&gt;
&lt;p&gt;Spring Profile有一个特性即可以在application.yml配置通用的内容，在application-dev.yml文件中配置不同文件的差异化配置，这样可以精简我们的配置文件。配置如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件主要用来存放公共设置，不受环境配置影响&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;8082&lt;/span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定端口号&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;context-path&lt;/span&gt;: /server &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定访问资源的根路径&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;spring&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;profiles&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;active&lt;/span&gt;: dev 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dev配置文件&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 主要用来存放不同环境差异化配置，包括ftp地址、数据库连接等&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;spring&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;datasource&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;username&lt;/span&gt;: xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;password&lt;/span&gt;: xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;url&lt;/span&gt;: xxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;driver-class-name&lt;/span&gt;: oracle.jdbc.driver.OracleDriver
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上述解决方案虽然可以解决我们的环境问题，但是不够优雅，还有一些值得优化的地方，比如打包出的配置文件有四个、每次需要手动修改主配置文件的环境信息等。&lt;/p&gt;
&lt;h2 id=&#34;maven-profile&#34;&gt;Maven Profile&lt;/h2&gt;
&lt;h3 id=&#34;profile配置&#34;&gt;Profile配置&lt;/h3&gt;
&lt;p&gt;Maven 也提供了 Profile 支持，它允许我们在 &lt;code&gt;pom.xml&lt;/code&gt; 中定义多个 Profile ，每个 profile 可以指定自己的一些配置、依赖、触发条件等。例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;profiles&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;profile&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;id&amp;gt;&lt;/span&gt;dev&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/id&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;activation&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;activeByDefault&amp;gt;&lt;/span&gt;true&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/activeByDefault&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/activation&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;profile.active&amp;gt;&lt;/span&gt;dev&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/profile.active&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/profile&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;profile&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;id&amp;gt;&lt;/span&gt;prod&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/id&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;profile.active&amp;gt;&lt;/span&gt;prod&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/profile.active&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/profile&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/profiles&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;按照上述的配置，我们配置了dev/test/prod三种配置并默认选择dev环境。&lt;/p&gt;
&lt;h3 id=&#34;资源过滤&#34;&gt;资源过滤&lt;/h3&gt;
&lt;p&gt;在进行打包的时候，我们并不需要把dev或者test等配置文件打包进行，所有我们在打包的时候进行如下配置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;build&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;resources&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;resource&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;directory&amp;gt;&lt;/span&gt;src/main/resources&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;&amp;lt;!--先排除所有的配置文件--&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;excludes&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;exclude&amp;gt;&lt;/span&gt;application*.yml&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/exclude&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/excludes&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/resource&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;10&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;resource&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;11&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;directory&amp;gt;&lt;/span&gt;src/main/resources&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;12&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;&amp;lt;!--引入所需环境的配置文件--&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;13&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;filtering&amp;gt;&lt;/span&gt;true&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/filtering&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;14&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;includes&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;15&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;include&amp;gt;&lt;/span&gt;application.yml&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/include&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;16&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;include&amp;gt;&lt;/span&gt;application-${profile.active}.yml&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/include&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;17&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/includes&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;18&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/resource&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;19&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/resources&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;20&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;21&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;22&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;23&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-maven-plugin&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;24&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;25&lt;/span&gt;&lt;span&gt;                    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;classifier&amp;gt;&lt;/span&gt;exec&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/classifier&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;26&lt;/span&gt;&lt;span&gt;                &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;27&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;28&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;29&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;主要是分为两个步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先排除所有的配置文件&lt;/li&gt;
&lt;li&gt;引入我们所需要的配置文件，根据${profile.active}来动态指定&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;熟悉idea的同学都知道，这里的${profile.active}我们在idea的maven的配置处进行快速的切换。&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://ws3.sinaimg.cn/large/006tNc79gy1fz7n4eweklj30gc08w0ta.jpg&#34;
  alt=&#34;&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;从上面的配置文件可以看出，我们引入了两个配置文件(application.yml)，一个是主配置文件，一个是实际环境(application-dev.yml)的配置文件,但是到这里还没有结束。我们知道主配置文件的dev/test/prod在没有使用Maven Profile的时候，我们是需要手动修改的，但是使用Maven Profile之后，我们可以把这个工作交给maven去做。&lt;/p&gt;
&lt;p&gt;在application.yml进行下面的修改：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;spring&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;profiles&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;active&lt;/span&gt;: @profile.active@ &lt;span style=&#34;color:#7f848e&#34;&gt;#此处由maven的环境选择决定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样我们就可以完全把配置文件的指定和生成交给maven。&lt;/p&gt;
&lt;h3 id=&#34;spring-profile与maven-profile具体使用&#34;&gt;Spring Profile与Maven Profile具体使用&lt;/h3&gt;
&lt;p&gt;配置如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yml&#34; data-lang=&#34;yml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件主要用来存放公共设置，不受环境配置影响&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;3&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;port&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;8082&lt;/span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定端口号&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;4&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;context-path&lt;/span&gt;: /server &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定访问资源的根路径&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;5&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;spring&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;6&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;profiles&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#55595f&#34;&gt;7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;active&lt;/span&gt;: @profile.active@ &lt;span style=&#34;color:#7f848e&#34;&gt;#此处由maven的环境选择决定&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&#34;https://lotabout.me/2018/Maven-Profile-and-Spring-Profile/&#34;&gt;Maven Profile 与 Spring Profile 管理多环境打包&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/java/springboot/springboot-maven-profile/</guid>
      <pubDate>Sun, 06 Jan 2019 23:05:54 +0800</pubDate>
    </item>
    
    <item>
      <title>2018-life-summary</title>
      <link>https://haigeek.me/posts/life/2018-life-summary/</link>
      <description>&lt;p&gt;2018年度总结&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzI4MjQ4MzAzMg==&amp;amp;mid=2247483717&amp;amp;idx=1&amp;amp;sn=4ce9dab02828d12aa56689d096cbcfa7&amp;amp;chksm=eb980172dcef88644cb4d47311e300cfde0f260291b3d237b6899463a65c9b05941f1092e1e6&amp;amp;token=1478250301&amp;amp;lang=zh_CN#rd&#34;&gt;2018掠影&lt;/a&gt;&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/life/2018-life-summary/</guid>
      <pubDate>Tue, 01 Jan 2019 22:54:58 +0800</pubDate>
    </item>
    
    <item>
      <title>Jenkins部署项目到远程windows</title>
      <link>https://haigeek.me/posts/backend/devops/jenkins/jenkins-deploy-remote-windows-server/</link>
      <description>&lt;p&gt;核心是使用ssh进行jenkins主节点与目标部署服务器进行通信,文件传输走scp协议,执行执行使用ssh命令远程到目标主机进行执行.&lt;/p&gt;
&lt;h1 id=&#34;jenkins部署项目到远程windows&#34;&gt;Jenkins部署项目到远程windows&lt;/h1&gt;
&lt;p&gt;使用ssh进行jenkins主节点与目标部署服务器进行通信,文件传输走scp协议,执行执行使用ssh命令远程到目标主机进行执行.&lt;/p&gt;
&lt;h2 id=&#34;ssh调用命令脚本&#34;&gt;ssh调用命令脚本&lt;/h2&gt;
&lt;p&gt;使用ssh命令远程服务器进行脚本调用的时候的流程是:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在本级ssh到目标主机&lt;/li&gt;
&lt;li&gt;调用目标主机的脚本启动tomcat,假如我们调用的是bin目录下startup.bat&lt;/li&gt;
&lt;li&gt;本机的终端窗口有输出,远程主机的tomcat启动成功&lt;/li&gt;
&lt;li&gt;关闭本级的ssh终端&lt;/li&gt;
&lt;li&gt;远程的tomcat随之关闭&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;要解决的问题&#34;&gt;要解决的问题&lt;/h2&gt;
&lt;h3 id=&#34;ssh调用的进程的生命周期问题&#34;&gt;&lt;strong&gt;ssh调用的进程的生命周期问题&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;查阅资料发现&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/RSt43Z2rHJxyqBL.png&#34;
  alt=&#34;image-20190704223510253.png&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;针对上述情况在linux下的解决方案很多,这里描述下winsows的解决方案.&lt;/p&gt;
&lt;p&gt;在这个&lt;a href=&#34;https://stackoverflow.com/questions/3382082/whats-the-nohup-on-windows&#34;&gt;回答&lt;/a&gt;下,采取了将tomcat做成Windows服务的方式,问题得到解决,具体的配置方式如下:&lt;/p&gt;
&lt;h4 id=&#34;设置tomcat的环境变量&#34;&gt;设置tomcat的环境变量&lt;/h4&gt;
&lt;p&gt;下载安装版的Windows版tomcat,在bin目录下分别为server.bat、startup.bat、shutdown.bat设置环境变量,如下所示&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/zDkqpmhANiVUSwv.png&#34;
  alt=&#34;image-20190704224910131.png&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h4 id=&#34;将tomcat注册为服务&#34;&gt;将tomcat注册为服务&lt;/h4&gt;
&lt;p&gt;进入bin文件夹下执行&lt;/p&gt;
&lt;p&gt;service install 服务名称&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/1U8BFIoHsxwm4Xi.png&#34;
  alt=&#34;[图片上传中&amp;amp;hellip;(image-20190704230244896.png-4869a1-1562942345129-0)]
&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h4 id=&#34;服务的启动与停止&#34;&gt;服务的启动与停止&lt;/h4&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;net stop server-name
net start server-name
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/uXMvU1ZebLsGHoc.png&#34;
  alt=&#34;image-20190704230244896.png&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;将这两条指令做成bat脚本,放在bin目录下,供之后jenkins直接调用.&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/EfkJxQhyedWLj1H.png&#34;
  alt=&#34;image-20190704230544740.png&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h3 id=&#34;jenkins的终端输出乱码&#34;&gt;jenkins的终端输出乱码&lt;/h3&gt;
&lt;p&gt;在linux下远程调用Windows的终端的时候,在jenksin的控制台总是乱码.查阅资料多数是说设置Jenkins的编码为U8,但是我安装的jenkins本身设置就是U8,后来发现在远程调用的bat脚本第一行设置为&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;chcp 65001
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;表示切换到utf-8模式即可,之后输出默认为英文且不会再乱码.&lt;/p&gt;
&lt;h3 id=&#34;是否有必要每次重启tomcat&#34;&gt;是否有必要每次重启Tomcat&lt;/h3&gt;
&lt;h4 id=&#34;场景&#34;&gt;场景&lt;/h4&gt;
&lt;p&gt;在实际使用的过程中,每次部署假如都需要重启tomcat的话使得整个系统变得不稳定,那么是否每次更新都要重启tomcat呢?&lt;/p&gt;
&lt;p&gt;首先我描述一下我遇到的一个问题,在jenkins中设置了一个重启tomcat的脚本,脚本如下:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pipeline {
    environment {
        // 部署远程主机ip地址,需要通过密钥的方式设置免密登录
        remoteIp = &amp;#34;127.0.0.1&amp;#34;
        remotePort=&amp;#39;22&amp;#39;
        // 失败通知Email
        email = &amp;#34;test@haigeek.cn&amp;#34;
        // 远程tomcat位置(windows要使用/来表示路径)
        tomcatPath = &amp;#34;E:/tomcat/apache-tomcat-8.5&amp;#34;
        tomcatPathDisk = &amp;#34;E:&amp;#34;
    }
    agent any
    tools {
        maven &amp;#39;maven-3.6.1&amp;#39;
    }
    stages {
        stage(&amp;#39;Deploy&amp;#39;) {
            steps {
                withEnv([&amp;#39;JENKINS_NODE_COOKIE=dontKillMe&amp;#39;]) {
                    sh &amp;#39;&amp;#39;&amp;#39;
                        export BUILD_ID=dontKillMe
                        echo &amp;#34;开始使用scp传输文件&amp;#34;
                        echo &amp;#34;开始调用远程tomcat进行重启&amp;#34;
                        ssh  -p ${remotePort} administrator@${remoteIp} &amp;#34;cd ${tomcatPath}/bin &amp;amp;&amp;amp; ${tomcatPathDisk} &amp;amp;&amp;amp; restart&amp;#34;
                    &amp;#39;&amp;#39;&amp;#39;
                }
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;上面的脚本核心功能就是调用远程tomca下的restart脚本来重启动tomcat,因为使用net stop tomcat 来关闭tomcat需要比较长时间,加上我们tomcat上运行的是dubbo项目,因此我直接使用taskkill的方式,根据dubbo端口来杀进程,结论是每次都可以成功杀死进程并重启tomcat,如下图,kill的脚本如下:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@echo off
chcp 65001
REM 设置dubbo端口号
 set port=30109
 for /f &amp;#34;tokens=5&amp;#34; %%i in (&amp;#39;netstat -aon ^| findstr &amp;#34;:%port%&amp;#34;&amp;#39;) do (
    set n=%%i
 )
 taskkill /pid %n% -F
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;jenkins的输出如下:&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/hznKDZfcUkq1bwS.png&#34;
  alt=&#34;image-20190712221521459.png&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;但是当我将这个脚本集成在完整的pipeline中,会出现taskkill失败的情况,报错为&lt;strong&gt;PIDxxx为系统进程,无法杀死&lt;/strong&gt;.&lt;/p&gt;
&lt;h4 id=&#34;分析&#34;&gt;分析&lt;/h4&gt;
&lt;p&gt;分析了一下,唯一不同的是我在杀死tomcat之前将最新打包出的war包移动到了tomcat下,此时tomcat开始自动解压并重新部署,注意&lt;strong&gt;此时进程已经不是tomcat的进程id,而是切换为系统的进程&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;在后期的测试中发现war包可以自动帮助我们热更新,这个功能可以大大减少我们更新的速度.&lt;/p&gt;
&lt;h4 id=&#34;解决&#34;&gt;解决&lt;/h4&gt;
&lt;p&gt;解决方法很简单,将kill tomcat的指令放在移动war包之前,不再报错.&lt;/p&gt;
&lt;h2 id=&#34;完整pipeline&#34;&gt;完整Pipeline&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// 持续集成脚本，勿动

pipeline {
    environment {
        // 部署远程主机ip地址,需要通过密钥的方式设置免密登录
        remoteIp = &amp;#34;127.0.0.1&amp;#34;
        remoteName = &amp;#34;administrator&amp;#34;
        remotePort=&amp;#39;22&amp;#39;
        // 远程tomcat位置(使用/来表示路径)
        tomcatPath = &amp;#34;C:/tomcat/apache-tomcat-8&amp;#34;
        tomcatPathDisk = &amp;#34;C:&amp;#34;
    }
    agent any
    tools {
        maven &amp;#39;maven-3.6.1&amp;#39;
    }
    stages {
         stage(&amp;#39;pullcode&amp;#39;){
            steps{
                git branch: &amp;#39;dev&amp;#39;, credentialsId: &amp;#39;xxx&amp;#39;, url: &amp;#39;http://xxx.git&amp;#39;
            }
        }

        stage(&amp;#39;Build&amp;#39;) {
            steps {
                sh &amp;#39;&amp;#39;&amp;#39;
                    echo &amp;#34;开始编译打包过程&amp;#34;
                    echo &amp;#34;PATH = ${PATH}&amp;#34;
                    echo &amp;#34;M2_HOME = ${M2_HOME}&amp;#34;
                    mvn clean &amp;amp;&amp;amp; mvn package -DskipTests=true
                &amp;#39;&amp;#39;&amp;#39;
            }
        }
          stage(&amp;#39;Test&amp;#39;){
            steps {
                sh &amp;#39;echo &amp;#34;Test stage&amp;#34;&amp;#39;
            }
        }

        stage(&amp;#39;Deploy&amp;#39;) {
            steps {
                withEnv([&amp;#39;JENKINS_NODE_COOKIE=dontKillMe&amp;#39;]) {
                    sh &amp;#39;&amp;#39;&amp;#39;
                        export BUILD_ID=dontKillMe
                        echo &amp;#34;关闭tomcat,此步非必须,可使用war进行热部署&amp;#34;
                        ssh  -p ${remotePort} administrator@${remoteIp} &amp;#34;cd ${tomcatPath}/bin &amp;amp;&amp;amp; ${tomcatPathDisk} &amp;amp;&amp;amp; dubbokill&amp;#34;
                        echo &amp;#34;开始使用scp传输文件&amp;#34;
                        warfile1=$(ls 项目名称/target/*.war)
                        scp -P ${remotePort} &amp;#34;${warfile1}&amp;#34;  ${remoteName}@${remoteIp}:${tomcatPath}/webapps
                        warfile2=$(ls 项目名称/target/*.war)
                        scp -P ${remotePort} &amp;#34;${warfile2}&amp;#34;  ${remoteName}@${remoteIp}:${tomcatPath}/webapps
                        echo &amp;#34;开始调用远程tomcat进行重启,此步骤非必须&amp;#34;
                        ssh  -p ${remotePort} administrator@${remoteIp} &amp;#34;cd ${tomcatPath}/bin &amp;amp;&amp;amp; ${tomcatPathDisk} &amp;amp;&amp;amp; servicestart&amp;#34;
                    &amp;#39;&amp;#39;&amp;#39;
                }
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/backend/devops/jenkins/jenkins-deploy-remote-windows-server/</guid>
      <pubDate>Tue, 01 Jan 2019 22:54:58 +0800</pubDate>
    </item>
    
    <item>
      <title>Jenkins快速复制已经存在的项目</title>
      <link>https://haigeek.me/posts/backend/devops/jenkins/jenkins-clone-project/</link>
      <description>&lt;p&gt;jenkins的pipeline的灵活之处在于对于已经存在的项目，可以快速复制出来，创建新的任务。&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;h1 id=&#34;jenkins快速复制已经存在的项目&#34;&gt;Jenkins快速复制已经存在的项目&lt;/h1&gt;
&lt;p&gt;针对已经存在的项目，可以快速复制出来，创建新的任务&lt;/p&gt;
&lt;p&gt;前提是需要200.39服务器可以访问目标部署服务器，假如不支持访问，需要先配置目标服务器，后续写配置方式（熟练的话5分钟可配置完成）。&lt;/p&gt;
&lt;h2 id=&#34;具体步骤&#34;&gt;具体步骤&lt;/h2&gt;
&lt;h3 id=&#34;1创建任务&#34;&gt;1、创建任务&lt;/h3&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/oxtQTSyEq9MjCf8.png&#34;
  alt=&#34;image-20200428002829443&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;h3 id=&#34;2配置流水线&#34;&gt;2、配置流水线&lt;/h3&gt;
&lt;p&gt;需要准备的数据有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器ip&lt;/li&gt;
&lt;li&gt;tomcat文件夹&lt;/li&gt;
&lt;li&gt;gitlab仓库地址（明确分支）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;修改描述&lt;/p&gt;
&lt;p&gt;&lt;img
  src=&#34;https://s2.loli.net/2022/12/24/jwOCgLueUNqiXVz.png&#34;
  alt=&#34;image-20200428005053908&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;修改流水线脚本，&lt;strong&gt;注意不要直接复制我的下面样例流水线配置，直接从复制出来的修改即可。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;主要做以下操作&lt;/p&gt;
&lt;p&gt;1、修改ip地址和tomcat的webapps地址，这里有个需要有注意的地方，&lt;strong&gt;假如tomcat的地址不存在空格的话，可以直接修改相关配置即可&lt;/strong&gt;。具体看注释1、2、3、4、5&lt;/p&gt;
&lt;p&gt;2、假如tomcat存在空格（不存在的话忽略此条），处理相对麻烦（暂时未攻克），直接参考注释6（相当于直接拼接出scp命令），&lt;strong&gt;另外配置了这种方式，步骤1可以不配置&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;3、设置gitlab地址和分支（拉代码需要有凭证，可以在jenkins添加，添加后才有访问仓库权限，目前凭证：zhaohj也就是赵海杰可以访问仓库的才能正常拉），修改位置在注释7&lt;/p&gt;
&lt;p&gt;4、设置打包命令和打包环境（如果复制的项目属于同类，基本不用改，确认下即可），修改在注释8，否则重新写打包命令。&lt;strong&gt;此处一定要明确部署采用什么环境，推荐先去服务器复制已经有的配置，然后修改代码的test配置，走test环境部署&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;5、确认要发送的war包，同上（如果复制的项目属于同类，基本不用改，确认下即可），否则就修改为target要发送的war包，修改地方在注释9&lt;/p&gt;
&lt;p&gt;6、全部修改完build测试，后续可以稳定使用&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;
pipeline {
    environment {
        // 部署远程主机ip地址,需要通过密钥的方式设置免密登录
        //注释1 服务器ip
        remoteIp = &amp;#34;192.168.1.196&amp;#34;
        //注释2 服务器登录用户
        remoteName = &amp;#34;administrator&amp;#34;
        //注释3 服务器ssh端口
        remotePort=&amp;#39;22&amp;#39;
        // 远程tomcat位置(使用/来表示路径)
        //注释4 tomcat安装位置
        tomcatPath = &amp;#34;D:/GT/Tomcat_zj&amp;#34;
        //注释5 tomcat所在磁盘
        tomcatPathDisk = &amp;#34;D:&amp;#34;
    }
    agent any
    tools {
        maven &amp;#39;maven-3.6.1&amp;#39;
    }
    stages {
         stage(&amp;#39;pullcode&amp;#39;){
            steps{
            		//注释7
                git branch: &amp;#39;dev&amp;#39;, credentialsId: &amp;#39;zhaohjgitlab&amp;#39;, url: &amp;#39;http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/xdata/SH2019GH080/back-end/dgp-dubbo-server-root.git&amp;#39;
            }
        }

        stage(&amp;#39;Build&amp;#39;) {
            steps {
                sh &amp;#39;&amp;#39;&amp;#39;
                    echo &amp;#34;开始编译打包过程&amp;#34;
                    echo &amp;#34;PATH = ${PATH}&amp;#34;
                    echo &amp;#34;M2_HOME = ${M2_HOME}&amp;#34;
                    //注释8
                    mvn clean package -P test -pl com.dist:dgp-pis-server-service -am
                &amp;#39;&amp;#39;&amp;#39;
            }
        }
          stage(&amp;#39;Test&amp;#39;){
            steps {
                sh &amp;#39;echo &amp;#34;Test stage&amp;#34;&amp;#39;
            }
        }

        stage(&amp;#39;Deploy&amp;#39;) {
            steps {
                withEnv([&amp;#39;JENKINS_NODE_COOKIE=dontKillMe&amp;#39;]) {
                    sh &amp;#39;&amp;#39;&amp;#39;
                        export BUILD_ID=dontKillMe
                        echo &amp;#34;开始使用scp传输文件&amp;#34;
                        //注释9
                        warfile1=$(ls dgp-pis-server-service/target/*.war)
                        //注释6 假如不存在空格不需要加这一行
                         scp -P ${remotePort} &amp;#34;${warfile1}&amp;#34;  &amp;#39;administrator@192.168.200.122:&amp;#34;C:/Program Files/Apache Software Foundation/Tomcat8_hz/webapps&amp;#34;&amp;#39;
												//使用了注释6 下面这一行就没用了
                        scp -P ${remotePort} &amp;#34;${warfile1}&amp;#34;  ${remoteName}@${remoteIp}:${tomcatPath}/webapps
                        echo &amp;#34;等待tomcat自动部署&amp;#34;
                    &amp;#39;&amp;#39;&amp;#39;
                }
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/backend/devops/jenkins/jenkins-clone-project/</guid>
      <pubDate>Tue, 01 Jan 2019 22:54:58 +0800</pubDate>
    </item>
    
    <item>
      <title>CentOS搭建FTP服务器vsftpd</title>
      <link>https://haigeek.me/posts/linux/centos-install-ftp-vsftpd/</link>
      <description>&lt;p&gt;vsftpd是linux平台下的一款ftp软件&lt;/p&gt;
&lt;h1 id=&#34;centos搭建ftp服务器vsftpd&#34;&gt;CentOS搭建FTP服务器vsftpd&lt;/h1&gt;
&lt;p&gt;vsftpd是linux平台下的一款ftp软件&lt;/p&gt;
&lt;h2 id=&#34;安装vsftpd&#34;&gt;安装vsftpd&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;安装&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;yum install vsftpd
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;设置开机启动&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;chkconfig vsftpd on
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;启动vsftpd服务&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service vsftpd start
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;管理vsftpd的其他命令&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service vsftpd stop
service vsftpd restart
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;防火墙设置&#34;&gt;防火墙设置&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ftp默认的端口是21，而centos默认是没有开启的，修改iptables文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/sysconfig/iptables
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在“-A INPUT –m state &amp;ndash;state NEW –m tcp –p –dport 22 –j ACCEPT”，下添加：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;-A INPUT -m state --state NEW -m tcp -p -dport 21 -j ACCEPT
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;修改保存文件，重启防火墙&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service iptables restart
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;配置vsftpd&#34;&gt;配置vsftpd&lt;/h2&gt;
&lt;p&gt;默认的配置文件是/etc/vsftpd/vsftpd.conf&lt;/p&gt;
&lt;h3 id=&#34;设置匿名用户登录和操作&#34;&gt;设置匿名用户登录和操作&lt;/h3&gt;
&lt;p&gt;修改vsftpd.conf文件的配置&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/vsftpd/vsftpd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;＃允许匿名用户登录FTP（如果不允许匿名访问就设置为NO）
anonymous_enable=YES&lt;/p&gt;
&lt;p&gt;＃打开匿名用户的上传权限
anon_upload_enable=YES&lt;/p&gt;
&lt;p&gt;＃打开匿名用户创建目录的权限
anon_mkdir_write_enable=YES#&lt;/p&gt;
&lt;p&gt;允许匿名用户具有建立目录和上传之外的权限，如重命名、删除等。anon_other_write_enable=YES&lt;/p&gt;
&lt;p&gt;###ftp目录的权限设置&lt;/p&gt;
&lt;p&gt;ftp的根目录为/var/ftp，为了安全，这个目录默认不允许设置为777权限，否则ftp将无法访问，/var/ftp/pub是匿名用户的默认访问目录，即vsftpd.conf文件中没有anon_root设置时的默认目录&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;匿名用户上传下载&lt;/p&gt;
&lt;p&gt;新建一个文件夹,修改它的权限为完全开放,任何用户就可以登录这个文件夹,并上传下载文件&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkdir /var/ftp/guest
chmod 777 /var/ftp/guest
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;可能遇到的问题&#34;&gt;可能遇到的问题&lt;/h2&gt;
&lt;h3 id=&#34;windows资源管理器上传文件乱码&#34;&gt;windows资源管理器上传文件乱码&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;由于win的GBK编码，在上传文件到linux ftp的时候，上传的文件会显示乱码；&lt;/li&gt;
&lt;li&gt;解决方式：使用ftp客户端，在文件&amp;ndash;站点管理器&amp;ndash;选中要设置的站点&amp;ndash;字符集&amp;ndash;强制使用utf-8&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其他配置待补充&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/linux/centos-install-ftp-vsftpd/</guid>
      <pubDate>Wed, 06 Sep 2017 20:46:37 +0800</pubDate>
    </item>
    
    <item>
      <title>centos6.8安装javajdk、tomcat、MySQL环境</title>
      <link>https://haigeek.me/posts/linux/centos6-8-install-javajdk-tomcat-mysql-env/</link>
      <description>&lt;h2 id=&#34;jdk安装&#34;&gt;jdk安装&lt;/h2&gt;
&lt;p&gt;建立一个文件夹存放软件安装包&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd /opt
mkdir setups
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;建立java安装文件夹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd /usr
mkdir java
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;解压文件并移动到java文件夹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;tar -zxvf jdk-8u131-linux-x64.tar.gz
mv jdk1.8.0_131 /usr/java
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置环境变量&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim /etc/profile
在末尾添加
JAVA_HOME=/usr/java/jdk1.8.0_131
  JRE_HOME=$JAVA_HOME/jre
  PATH=$PATH:$JAVA_HOME/bin
  CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
  export JAVA_HOME
  export JRE_HOME
  export PATH
  export CLASSPATH
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;刷新配置&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;source /etc/profile
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;检查配置&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;java -version
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;tomcat安装&#34;&gt;Tomcat安装&lt;/h2&gt;
&lt;p&gt;下载解压安装&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget http://www-us.apache.org/dist/tomcat/tomcat-8/v8.5.16/bin/apache-tomcat-8.5.16.tar.gz
tar -zxvf apache-tomcat-8.5.16.tar.gz
mv apache-tomcat-8.5.16 /usr/tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;运行&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sh /usr/tomcat/apache-tomcat-8.5.16/bin/startup.sh
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在浏览器输入http:ip地址:8080 测试；可以访问则表示成功，如果不可以访问需要配置防火墙规则&lt;/p&gt;
&lt;p&gt;进行如下设置并重启防火墙，这里需要注意，由于centos7采用了firewall防火墙，配置方法有所不同，可以参考相关资料&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# iptables -I INPUT -p tcp --dport 8080 -j ACCEPT
# service iptables restart
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;创建脚本文件方便tomcat启动&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim /etc/rc.d/init.d/tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;脚本文件如下，将Jdk和tomcat安装路径更换即可&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#!/bin/bash  
# description: Tomcat7 Start Stop Restart  
# processname: tomcat7  
# chkconfig: 234 20 80  
JAVA_HOME=/usr/java/jdk1.8.0_133
export JAVA_HOME  
PATH=$JAVA_HOME/bin:$PATH  
export PATH  
CATALINA_HOME=/usr/tomcat8
case $1 in  
start)  
sh $CATALINA_HOME/bin/startup.sh  
;;   
stop)     
sh $CATALINA_HOME/bin/shutdown.sh  
;;   
restart)  
sh $CATALINA_HOME/bin/shutdown.sh  
sh $CATALINA_HOME/bin/startup.sh  
;;   
esac      
exit 0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;设置文件属性和运行服务级别&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# chmod a+x tomcat
# chkconfig --add tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service tomcat start
service tomcat stop
service tomcat restart
service tomcat status
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;安装mysql数据库&#34;&gt;安装mysql数据库&lt;/h2&gt;
&lt;p&gt;检查是否已经安装&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;rpm -q mysql-libs
yum remove mysql-libs /** if exists **/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;下载安装mysql&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://dev.mysql.com/get/Downloads/MySQL-5.5/MySQL-server-5.5.56-1.el6.x86_64.rpm
wget https://dev.mysql.com/get/Downloads/MySQL-5.5/MySQL-client-5.5.56-1.el6.x86_64.rpm
wget https://dev.mysql.com/get/Downloads/MySQL-5.5/MySQL-devel-5.5.56-1.el6.x86_64.rpm
rpm -ivh MySQL-server-5.5.56-1.el6.x86_64.rpm
rpm -ivh MySQL-client-5.5.56-1.el6.x86_64.rpm
rpm -ivh MySQL-devel-5.5.56-1.el6.x86_64.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;安装时候需要注意centos系统为6是需要选择上面的版本&lt;/p&gt;
&lt;p&gt;开启数据库&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service mysql start
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;设置数据库root账户密码&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mysql&amp;gt; use mysql;
mysql&amp;gt; update user set password=PASSWORD(&amp;#34;GIVE-NEW-ROOT-PASSWORD&amp;#34;) where User=&amp;#39;root&amp;#39;;
mysql&amp;gt; flush privileges;
mysql&amp;gt; quit
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;数据库的配置&lt;/p&gt;
&lt;p&gt;在mysql5.5中，默认是没有类似 /etc/my.cof的配置文件的，只有在&lt;code&gt;/usr/share/mysql/&lt;/code&gt;下可以找到几个cnf后缀的配置文件，是根据内存大小来进行配置的，而如果想要修改编码，可以安装以下步骤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;通过输入命令&lt;code&gt;mysql --help | grep &#39;Default options&#39; -A 1&lt;/code&gt;可以查看mysql5.5读取数据库配置文件的顺序,输出如下&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;default options are read from the following files in the given order:
/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建配置文件 &lt;code&gt;vi /etc/my.cnf&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;进行编码设置&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[client]
port = 3306
socket = /var/lib/mysql/mysql.sock
default-character-set=utf8
[mysqld]
port = 3306
socket = /var/lib/mysql/mysql.sock
character-set-server=utf8
[mysql]
no-auto-rehash
default-character-set=utf8
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重启mysql&lt;code&gt;service mysql restart&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看是否生效&lt;code&gt;mysql&amp;gt; show variables like &#39;char%&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mysql&amp;gt; show variables like &amp;#39;char%&amp;#39;;
+--------------------------+----------------------------+
| Variable_name            | Value                      |
+--------------------------+----------------------------+
| character_set_client     | utf8                       |
| character_set_connection | utf8                       |
| character_set_database   | utf8                       |
| character_set_filesystem | binary                     |
| character_set_results    | utf8                       |
| character_set_server     | utf8                       |
| character_set_system     | utf8                       |
| character_sets_dir       | /usr/share/mysql/charsets/ |
+--------------------------+----------------------------+
8 rows in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;至此，mysql的配置安装也完成。&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/linux/centos6-8-install-javajdk-tomcat-mysql-env/</guid>
      <pubDate>Sat, 15 Jul 2017 14:12:28 +0800</pubDate>
    </item>
    
    <item>
      <title>你是我听不尽的天籁</title>
      <link>https://haigeek.me/posts/life/you-are-my-like-once/</link>
      <description>&lt;p&gt;&lt;img
  src=&#34;http://upload-images.jianshu.io/upload_images/1733731-0f72c126d74b55b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
  alt=&#34;搭车巡演&#34;
  loading=&#34;lazy&#34;
  decoding=&#34;async&#34;
  class=&#34;full-width&#34;
/&gt;

&lt;/p&gt;
&lt;p&gt;今天看了陈鸿宇九集纪录片，很有感觉，找个时间记一下。图片是第九集的end。&lt;/p&gt;
&lt;p&gt;从9月底到11月初，开了两个月的黄钻，对，就是Pony公司那个叫qq的软件的一项服务，可以隐身访问，拴住了一大部分人的需求。我就是其中一个。&lt;/p&gt;
&lt;p&gt;一步步探险，一点点尝试，直到有一天，进入了一个地方，说不出特别，但是其他人也没进来。
庆幸自己进来，烦闷又觉得原来还有一扇门。不想出去，还想探索，闯入一片不知道是不是自己的地方，也不愿马上跑出去，所以再探探。&lt;/p&gt;
&lt;p&gt;小心翼翼。觉得这片地方还是不属于自己。
所以我觉得这性格是个大问题。&lt;/p&gt;
&lt;p&gt;潜伏的经历多久都不会觉得难过，最多有时候有点累。暴毙的时刻似乎应该也不会觉得尴尬，至少回头看还像个样子。&lt;/p&gt;
&lt;p&gt;事真来的时候，总是比嘴上说的要难过的多。又是这个时候，一年了，去年这个时候，今年还是这个时候。突然就觉得有点意思，于是想要记下来，也没想过自己怎么改变然后剧情会怎么发展，可能没有去尝试所以终究是别人手里的果实。&lt;/p&gt;
&lt;p&gt;我可能是错过了最好的时机，所以也没有机会发现最美的你，和变得更好的我。
你是我听不尽的天籁，触手而不可及。天籁如果可以继续，我想把所有走过的路，化作不顾地奔跑。不是无尽，因有尔声。&lt;/p&gt;
&lt;p&gt;愿天下有情人终成眷属。&lt;/p&gt;
&lt;p&gt;今天也是一个表姐结婚的日子，希望他们幸福。祝好。&lt;/p&gt;</description>
      <author>haigeek</author>
      <guid>https://haigeek.me/posts/life/you-are-my-like-once/</guid>
      <pubDate>Fri, 02 Dec 2016 23:08:57 +0800</pubDate>
    </item>
    
  </channel>
</rss>
