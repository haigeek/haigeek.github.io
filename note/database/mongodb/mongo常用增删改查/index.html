
<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">

    <head>

        
        <meta charset="UTF-8" />

        
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

                
        <title> 
             mongo常用增删改查  
        </title>
        
        
            <link href="https://example.com/index.xml" rel="alternate" type="application/rss+xml" title="Kiss&#39;Em!" />
        

        
        <link rel="stylesheet" href="/css/style.css"/>

        
        
            <link rel='stylesheet' href='https://example.com/css/custom.css'>
        
        
    </head>

    <body>



<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://example.com">
          <h1 id="nav-heading" class="title is-4">Kiss&#39;Em!</h1>
        </a>
      </div>
      <div class="nav-right">
        
        
        <nav id="nav-items" class="nav-item level is-mobile">
          <a class="level-item" aria-label="about" href='/about'
           rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="8"></line>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="email" href='mailto:info@pavel-pi.de'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="github" href='https://github.com/pavel-pi'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="twitter" href='https://twitter.com/@_pavel_pi_'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="rss" href='/index.xml'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
        
      
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
    
    <div class="container">
    
        
            
<div class="subtitle tags is-6 is-pulled-right">
    
        
<a class="subtitle is-6" href="/tags/mongo/">#mongo</a>




    
</div>



<h2 class="subtitle is-6">
    
    
        December 28, 2017 | 21:48
    
</h2>



<h1 class="title">mongo常用增删改查</h1>

<div class="content">

    
    <h2 id="常用操作对照">常用操作对照</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.users.find() <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> age <span style="color:#f92672">=</span> <span style="color:#ae81ff">27</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#e6db74">&#34;joe&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;joe&#34;</span> <span style="color:#66d9ef">and</span> age <span style="color:#f92672">=</span> <span style="color:#ae81ff">27</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;email&#34;</span> : <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#66d9ef">select</span> username, email <span style="color:#66d9ef">from</span> users
db.users.find(<span style="color:#960050;background-color:#1e0010">{}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;_id&#34;</span> : <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#f92672">//</span> <span style="color:#66d9ef">no</span> <span style="color:#66d9ef">case</span>  <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">即时加上了列筛选，</span>_id也会返回<span style="color:#960050;background-color:#1e0010">；必须显式的阻止</span>_id返回
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$gte&#34;</span> : <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;$lte&#34;</span> : <span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> age <span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">18</span> <span style="color:#66d9ef">and</span> age <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">30</span> <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">$</span>lt(<span style="color:#f92672">&lt;</span>) <span style="color:#960050;background-color:#1e0010">$</span>lte(<span style="color:#f92672">&lt;=</span>) <span style="color:#960050;background-color:#1e0010">$</span>gt(<span style="color:#f92672">&gt;</span>) <span style="color:#960050;background-color:#1e0010">$</span>gte(<span style="color:#f92672">&gt;=</span>)
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$ne&#34;</span> : <span style="color:#e6db74">&#34;joe&#34;</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> username <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#34;joe&#34;</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;ticket_no&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$in&#34;</span> : [<span style="color:#ae81ff">725</span>, <span style="color:#ae81ff">542</span>, <span style="color:#ae81ff">390</span>]<span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> ticket_no <span style="color:#66d9ef">in</span> (<span style="color:#ae81ff">725</span>, <span style="color:#ae81ff">542</span>, <span style="color:#ae81ff">390</span>)
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;ticket_no&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$nin&#34;</span> : [<span style="color:#ae81ff">725</span>, <span style="color:#ae81ff">542</span>, <span style="color:#ae81ff">390</span>]<span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> ticket_no <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#ae81ff">725</span>, <span style="color:#ae81ff">542</span>, <span style="color:#ae81ff">390</span>)
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$or&#34;</span> : [<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;ticket_no&#34;</span> : <span style="color:#ae81ff">725</span><span style="color:#960050;background-color:#1e0010">}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;winner&#34;</span> : <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>]<span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> form users <span style="color:#66d9ef">where</span> ticket_no <span style="color:#f92672">=</span> <span style="color:#ae81ff">725</span> <span style="color:#66d9ef">or</span> winner <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;id_num&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$mod&#34;</span> : [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>]<span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> (id_num <span style="color:#66d9ef">mod</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$not&#34;</span>: <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">not</span> (age <span style="color:#f92672">=</span> <span style="color:#ae81ff">27</span>)
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$in&#34;</span> : [<span style="color:#66d9ef">null</span>], <span style="color:#e6db74">&#34;$exists&#34;</span> : <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> username <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">如果直接通过</span>find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#66d9ef">null</span><span style="color:#960050;background-color:#1e0010">}</span>)<span style="color:#960050;background-color:#1e0010">进行查询，那么连带</span><span style="color:#e6db74">&#34;没有username&#34;</span><span style="color:#960050;background-color:#1e0010">的纪录一并筛选出来</span>
db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#f92672">/</span>joey<span style="color:#f92672">?/</span>i<span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">正则查询，</span>value是符合PCRE的表达式
db.food.find(<span style="color:#960050;background-color:#1e0010">{</span>fruit : <span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">all</span> : [<span style="color:#e6db74">&#34;apple&#34;</span>, <span style="color:#e6db74">&#34;banana&#34;</span>]<span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">对数组的查询</span>, <span style="color:#960050;background-color:#1e0010">字段</span>fruit中<span style="color:#960050;background-color:#1e0010">，既包含</span><span style="color:#e6db74">&#34;apple&#34;</span>,<span style="color:#960050;background-color:#1e0010">又包含</span><span style="color:#e6db74">&#34;banana&#34;</span><span style="color:#960050;background-color:#1e0010">的纪录</span>
db.food.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;fruit.2&#34;</span> : <span style="color:#e6db74">&#34;peach&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">对数组的查询</span>, <span style="color:#960050;background-color:#1e0010">字段</span>fruit中<span style="color:#960050;background-color:#1e0010">，第</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">个</span>(<span style="color:#960050;background-color:#1e0010">从</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">开始</span>)<span style="color:#960050;background-color:#1e0010">元素是</span>peach的纪录
db.food.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;fruit&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$size&#34;</span> : <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">对数组的查询</span>, <span style="color:#960050;background-color:#1e0010">查询数组元素个数是</span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">的记录，$</span>size前面无法和其他的操作符复合使用
db.users.findOne(criteria, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;comments&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$slice&#34;</span> : <span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">}}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">对数组的查询，只返回数组</span>comments中的前十条<span style="color:#960050;background-color:#1e0010">，还可以{</span><span style="color:#e6db74">&#34;$slice&#34;</span> : <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">}，</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$slice&#34;</span> : [<span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">10</span>]<span style="color:#960050;background-color:#1e0010">}</span>; <span style="color:#960050;background-color:#1e0010">分别返回最后</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">条，和中间</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">条</span>
db.people.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;name.first&#34;</span> : <span style="color:#e6db74">&#34;Joe&#34;</span>, <span style="color:#e6db74">&#34;name.last&#34;</span> : <span style="color:#e6db74">&#34;Schmoe&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>)  <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">嵌套查询</span>
db.blog.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;comments&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$elemMatch&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;author&#34;</span> : <span style="color:#e6db74">&#34;joe&#34;</span>, <span style="color:#e6db74">&#34;score&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$gte&#34;</span> : <span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">}}}}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">嵌套查询，仅当嵌套的元素是数组时使用</span>,
db.foo.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$where&#34;</span> : <span style="color:#e6db74">&#34;this.x + this.y == 10&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">复杂的查询，$</span>where当然是非常方便的<span style="color:#960050;background-color:#1e0010">，但效率低下。对于复杂查询，考虑的顺序应当是</span> <span style="color:#960050;background-color:#1e0010">正则</span> <span style="color:#f92672">-&gt;</span> MapReduce <span style="color:#f92672">-&gt;</span> <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#66d9ef">where</span>
db.foo.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$where&#34;</span> : <span style="color:#e6db74">&#34;function() { return this.x + this.y == 10; }&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>) <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">$</span>where可以支持javascript函数作为查询条件
db.foo.find().sort(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;x&#34;</span> : <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}</span>).<span style="color:#66d9ef">limit</span>(<span style="color:#ae81ff">1</span>).skip(<span style="color:#ae81ff">10</span>); <span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">返回第</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>]<span style="color:#960050;background-color:#1e0010">条，按</span><span style="color:#e6db74">&#34;x&#34;</span><span style="color:#960050;background-color:#1e0010">进行排序</span>; <span style="color:#960050;background-color:#1e0010">三个</span>limit的顺序是任意的<span style="color:#960050;background-color:#1e0010">，应该尽量避免</span>skip中使用large<span style="color:#f92672">-</span>number
</code></pre></div><h2 id="更新语句">更新语句</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.col.<span style="color:#66d9ef">update</span>(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#39;user&#39;</span>:<span style="color:#e6db74">&#39;c4088e80-e467-43ca-bafa-4e566bb6b892&#39;</span><span style="color:#960050;background-color:#1e0010">}</span>,<span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">set</span>:<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#39;startTime&#39;</span>:ISODate(<span style="color:#e6db74">&#34;2020-06-15T11:12:36.236Z&#34;</span>)<span style="color:#960050;background-color:#1e0010">}}</span>)
</code></pre></div><p>更新多条</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.getCollection(<span style="color:#e6db74">&#39;dus_proxy&#39;</span>).<span style="color:#66d9ef">update</span>(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;sort&#34;</span>:<span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">}</span>,<span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">set</span>:<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;user&#34;</span>:<span style="color:#e6db74">&#34;5ef99a58c4d79c95c1039381&#34;</span><span style="color:#960050;background-color:#1e0010">}}</span>,<span style="color:#960050;background-color:#1e0010">{</span>multi:<span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>)
</code></pre></div><h3 id="插入属性">插入属性</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.getCollection(<span style="color:#e6db74">&#39;dus_proxy&#39;</span>).<span style="color:#66d9ef">update</span>(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;sort&#34;</span>:<span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">}</span>,<span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">set</span>:<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;serviceCatalog&#34;</span>:<span style="color:#e6db74">&#34;-1&#34;</span><span style="color:#960050;background-color:#1e0010">}}</span>,<span style="color:#960050;background-color:#1e0010">{</span>multi:<span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>)
</code></pre></div><p>当不存在某个属性时</p>
<p>语法说明：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.collection.<span style="color:#66d9ef">update</span>(
   <span style="color:#f92672">&lt;</span>query<span style="color:#f92672">&gt;</span>,
   <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">update</span><span style="color:#f92672">&gt;</span>,
   <span style="color:#960050;background-color:#1e0010">{</span>
     upsert: <span style="color:#f92672">&lt;</span>boolean<span style="color:#f92672">&gt;</span>,
     multi: <span style="color:#f92672">&lt;</span>boolean<span style="color:#f92672">&gt;</span>,
     writeConcern: <span style="color:#f92672">&lt;</span>document<span style="color:#f92672">&gt;</span>
   <span style="color:#960050;background-color:#1e0010">}</span>
)
</code></pre></div><p>参数说明：</p>
<ul>
<li>query: update的查询条件，类似sql update查询内where后面的。</li>
<li>update: update的对象和一些更新的操作符，也可以理解为sql update查询内set后面的。</li>
<li>upsert: 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew, true为插入，默认是false，不插入。</li>
<li>multi: 可选，mongodb默认是false，只更新找到的第一条记录，如果这个参数为true，则更新所有按条件查出来的多条记录。</li>
<li>writeConcern: 可选，抛出异常的级别。</li>
</ul>
<p>样例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.getCollection(<span style="color:#e6db74">&#39;dus_proxy&#39;</span>).<span style="color:#66d9ef">update</span>(
    <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;serviceCatalog&#34;</span> : <span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">exists</span> : <span style="color:#66d9ef">false</span><span style="color:#960050;background-color:#1e0010">}}</span>,
    <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$set&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;serviceCatalog&#34;</span> : <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}}</span>,
    <span style="color:#66d9ef">false</span>,
    <span style="color:#66d9ef">true</span>
)
</code></pre></div><h3 id="排序">排序</h3>
<p>在 MongoDB 中使用 sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用于降序排列。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.getCollection(<span style="color:#e6db74">&#39;dus_log&#39;</span>).find().sort(<span style="color:#960050;background-color:#1e0010">{</span>startTime:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}</span>)
</code></pre></div><p>mongo修改字段类型</p>
<p>数据类型批量转换：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">db.tb_name.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;status&#34;</span>:<span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">type</span>:<span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}}</span>).forEach(<span style="color:#66d9ef">function</span>(x)<span style="color:#960050;background-color:#1e0010">{</span>x.status<span style="color:#f92672">=</span>NumberInt(x.status);db.tb_name.save(x)<span style="color:#960050;background-color:#1e0010">}</span>)
</code></pre></div><p>字段类型编号:</p>
<p>1 Double 浮点型</p>
<p>2 String UTF-8字符串都可表示为字符串类型的数据</p>
<p>3 Object 对象，嵌套另外的文档</p>
<p>4 Array 值的集合或者列表可以表示成数组</p>
<p>5 Binary data 二进制</p>
<p>7 Object id 对象id是文档的12字节的唯一 ID 系统默认会自动生成</p>
<p>8 Boolean 布尔类型有两个值TRUE和FALSE</p>
<p>9 Date 日期类型存储的是从标准纪元开始的毫秒数。不存储时区</p>
<p>10 Null 用于表示空值或者不存在的字段</p>
<p>11 Regular expression 采用js 的正则表达式语法</p>
<p>13 JavaScript code 可以存放Javasript 代码</p>
<p>14 Symbol 符号</p>
<p>15 JavaScript code with scope</p>
<p>16 32-bit integer 32位整数类型</p>
<p>17 Timestamp 特殊语义的时间戳数据类型</p>
<p>18 64-bit integer 64位整数类型</p>
<p>mongo时间查询</p>
<pre><code>(&gt;) 大于 - $gt
(&lt;) 小于 - $lt
(&gt;=) 大于等于 - $gte
(&lt;= ) 小于等于 - $lte
</code></pre><p>mongo查询数组是否为空</p>
<pre><code>db.getCollection('dus_apply_view').find({&quot;embedProxy&quot;:{$size:0}})
</code></pre><p>删除某个字段</p>
<pre><code>db.getCollection('dus_proxy').update({},{$unset:{&quot;orgname&quot;:&quot;&quot;}},false,true)
</code></pre><p>删除索引</p>
<pre><code>db.COLLECTION_NAME.dropIndex(&quot;INDEX-NAME&quot;)
</code></pre><p>不等于</p>
<pre><code>db.getCollection('dus_proxy').find({&quot;user&quot;:{&quot;$ne&quot;:&quot;5f2bfb6abffbc0171c24ee2e&quot;}})
</code></pre><p>联表查询</p>
<pre><code>db.getCollection('dus_apply_cart').aggregate([
   {
     $lookup:
       {
  from: 'dus_proxy',
  localField: 'serviceId',
  foreignField: '_id',
  as: 'proxy'
}
  },
  { $match : {&quot;proxy&quot; : [ ]} }
])
</code></pre>

    
    
        <div class="related">


<h3>Similar articles</h3>

<ul>
	
	<li><a href="/note/database/mongodb/mongodb%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/">mongoDB数据库备份与恢复</a></li>
	
	<li><a href="/note/database/mongodb/mongodb%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/">mongodb基本操作</a></li>
	
	<li><a href="/note/database/mongodb/mongo%E5%BC%80%E5%90%AF%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81/">mongo开启安全验证</a></li>
	
	<li><a href="/note/database/mongodb/mongo%E7%94%A8%E6%88%B7%E6%93%8D%E4%BD%9C/">mongo用户操作</a></li>
	
	<li><a href="/note/database/mongodb/mongo%E7%9A%84%E8%A7%86%E5%9B%BE/">mongo的视图操作</a></li>
	
</ul>


</div>
    

</div>


        

    </div>

</section>



<section class="section">
  <div class="container has-text-centered">
    <p>© <a href="https://github.com/pavel-pi">Pavel Pi</a> 2020</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/pavel-pi/kiss-em">Kiss'Em</a>.</p>
    
  </div>
</section>

</body>
</html>

