
<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">

    <head>

        
        <meta charset="UTF-8" />

        
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

                
        <title> 
             Jenkins快速复制已经存在的项目  
        </title>
        
        
            <link href="https://example.com/index.xml" rel="alternate" type="application/rss+xml" title="Kiss&#39;Em!" />
        

        
        <link rel="stylesheet" href="/css/style.css"/>

        
        
            <link rel='stylesheet' href='https://example.com/css/custom.css'>
        
        
    </head>

    <body>



<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://example.com">
          <h1 id="nav-heading" class="title is-4">Kiss&#39;Em!</h1>
        </a>
      </div>
      <div class="nav-right">
        
        
        <nav id="nav-items" class="nav-item level is-mobile">
          <a class="level-item" aria-label="about" href='/about'
           rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="8"></line>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="email" href='mailto:info@pavel-pi.de'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="github" href='https://github.com/pavel-pi'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="twitter" href='https://twitter.com/@_pavel_pi_'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a>
          <a class="level-item" aria-label="rss" href='/index.xml'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg></i>
            </span>
          </a></nav>
        
      
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
    
    <div class="container">
    
        
            
<div class="subtitle tags is-6 is-pulled-right">
    
        
<a class="subtitle is-6" href="/tags/jenkins/">#jenkins</a>




    
</div>



<h2 class="subtitle is-6">
    
    
        January 1, 2019 | 22:54
    
</h2>



<h1 class="title">Jenkins快速复制已经存在的项目</h1>

<div class="content">

    
    <h1 id="jenkins快速复制已经存在的项目">Jenkins快速复制已经存在的项目</h1>
<p>针对已经存在的项目，可以快速复制出来，创建新的任务</p>
<p>前提是需要200.39服务器可以访问目标部署服务器，假如不支持访问，需要先配置目标服务器，后续写配置方式（熟练的话5分钟可配置完成）。</p>
<h2 id="具体步骤">具体步骤</h2>
<h3 id="1创建任务">1、创建任务</h3>
<p><img src="images/image-20200428002829443.png" alt="image-20200428002829443"></p>
<h3 id="2配置流水线">2、配置流水线</h3>
<p>需要准备的数据有：</p>
<ul>
<li>服务器ip</li>
<li>tomcat文件夹</li>
<li>gitlab仓库地址（明确分支）</li>
</ul>
<p>修改描述</p>
<p><img src="images/image-20200428005053908.png" alt="image-20200428005053908"></p>
<p>修改流水线脚本，<strong>注意不要直接复制我的下面样例流水线配置，直接从复制出来的修改即可。</strong></p>
<p>主要做以下操作</p>
<p>1、修改ip地址和tomcat的webapps地址，这里有个需要有注意的地方，<strong>假如tomcat的地址不存在空格的话，可以直接修改相关配置即可</strong>。具体看注释1、2、3、4、5</p>
<p>2、假如tomcat存在空格（不存在的话忽略此条），处理相对麻烦（暂时未攻克），直接参考注释6（相当于直接拼接出scp命令），<strong>另外配置了这种方式，步骤1可以不配置</strong></p>
<p>3、设置gitlab地址和分支（拉代码需要有凭证，可以在jenkins添加，添加后才有访问仓库权限，目前凭证：zhaohj也就是赵海杰可以访问仓库的才能正常拉），修改位置在注释7</p>
<p>4、设置打包命令和打包环境（如果复制的项目属于同类，基本不用改，确认下即可），修改在注释8，否则重新写打包命令。<strong>此处一定要明确部署采用什么环境，推荐先去服务器复制已经有的配置，然后修改代码的test配置，走test环境部署</strong>。</p>
<p>5、确认要发送的war包，同上（如果复制的项目属于同类，基本不用改，确认下即可），否则就修改为target要发送的war包，修改地方在注释9</p>
<p>6、全部修改完build测试，后续可以稳定使用</p>
<pre><code>
pipeline {
    environment {
        // 部署远程主机ip地址,需要通过密钥的方式设置免密登录
        //注释1 服务器ip
        remoteIp = &quot;192.168.1.196&quot;
        //注释2 服务器登录用户
        remoteName = &quot;administrator&quot;
        //注释3 服务器ssh端口
        remotePort='22'
        // 远程tomcat位置(使用/来表示路径)
        //注释4 tomcat安装位置
        tomcatPath = &quot;D:/GT/Tomcat_zj&quot;
        //注释5 tomcat所在磁盘
        tomcatPathDisk = &quot;D:&quot;
    }
    agent any
    tools {
        maven 'maven-3.6.1'
    }
    stages {
         stage('pullcode'){
            steps{
            		//注释7
                git branch: 'dev', credentialsId: 'zhaohjgitlab', url: 'http://elb-791125809.cn-northwest-1.elb.amazonaws.com.cn:5335/xdata/SH2019GH080/back-end/dgp-dubbo-server-root.git'
            }
        }

        stage('Build') {
            steps {
                sh '''
                    echo &quot;开始编译打包过程&quot;
                    echo &quot;PATH = ${PATH}&quot;
                    echo &quot;M2_HOME = ${M2_HOME}&quot;
                    //注释8
                    mvn clean package -P test -pl com.dist:dgp-pis-server-service -am
                '''
            }
        }
          stage('Test'){
            steps {
                sh 'echo &quot;Test stage&quot;'
            }
        }

        stage('Deploy') {
            steps {
                withEnv(['JENKINS_NODE_COOKIE=dontKillMe']) {
                    sh '''
                        export BUILD_ID=dontKillMe
                        echo &quot;开始使用scp传输文件&quot;
                        //注释9
                        warfile1=$(ls dgp-pis-server-service/target/*.war)
                        //注释6 假如不存在空格不需要加这一行
                         scp -P ${remotePort} &quot;${warfile1}&quot;  'administrator@192.168.200.122:&quot;C:/Program Files/Apache Software Foundation/Tomcat8_hz/webapps&quot;'
												//使用了注释6 下面这一行就没用了
                        scp -P ${remotePort} &quot;${warfile1}&quot;  ${remoteName}@${remoteIp}:${tomcatPath}/webapps
                        echo &quot;等待tomcat自动部署&quot;
                    '''
                }
            }
        }
    }
}
</code></pre>

    
    
        <div class="related">


<h3>Similar articles</h3>

<ul>
	
	<li><a href="/posts/backend/devops/jenkins/jenkins%E5%AE%89%E8%A3%85/">Jenkins入门</a></li>
	
	<li><a href="/posts/backend/devops/jenkins/jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E5%88%B0%E8%BF%9C%E7%A8%8Bwindows%E4%B8%BB%E6%9C%BA/">Jenkins部署项目到远程windows</a></li>
	
</ul>


</div>
    

</div>


        

    </div>

</section>



<section class="section">
  <div class="container has-text-centered">
    <p>© <a href="https://github.com/pavel-pi">Pavel Pi</a> 2020</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/pavel-pi/kiss-em">Kiss'Em</a>.</p>
    
  </div>
</section>

</body>
</html>

